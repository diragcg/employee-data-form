<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>डेटा प्रविष्टि टेस्ट</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>

<div class="container my-5">
  <h3 class="mb-3">डेटा प्रविष्टि से परीक्षण</h3>
  <table class="table table-bordered" id="entryTable">
    <thead class="table-success">
      <tr>
        <th>फसल</th>
        <th>समिति</th>
        <th>बीज निगम</th>
        <th>कार्य</th>
      </tr>
    </thead>
    <tbody id="tableBody"></tbody>
  </table>
  <button id="addRowBtn" class="btn btn-primary mb-3">नई पंक्ति जोड़ें</button>
  <br />
  <button id="submitBtn" class="btn btn-success">सबमिट करें</button>

  <div id="alertBox" class="mt-3"></div>
</div>

<script>
  const addRowBtn = document.getElementById('addRowBtn');
  const submitBtn = document.getElementById('submitBtn');
  const tableBody = document.getElementById('tableBody');
  const alertBox = document.getElementById('alertBox');

  // Add a new empty row with input fields
  function addRow() {
    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td><input type="text" class="form-control" placeholder="फसल का नाम" /></td>
      <td><input type="text" class="form-control" placeholder="समिति" /></td>
      <td><input type="text" class="form-control" placeholder="बीज निगम" /></td>
      <td><button type="button" class="btn btn-danger btn-sm removeBtn">हटाएँ</button></td>
    `;

    tableBody.appendChild(tr);

    // Attach delete functionality
    tr.querySelector('.removeBtn').addEventListener('click', () => tr.remove());
  }

  addRowBtn.addEventListener('click', addRow);

  submitBtn.addEventListener('click', () => {
    alertBox.innerHTML = '';
    const rows = tableBody.querySelectorAll('tr');
    if (rows.length === 0) {
      alertBox.innerHTML = '<div class="alert alert-danger">कृपया कम से कम एक रिकॉर्ड जोड़ें।</div>';
      return;
    }

    const records = [];
    let validationErrors = [];

    rows.forEach((tr, index) => {
      const tds = tr.querySelectorAll('input');
      const crop = tds[0].value.trim();
      const committee = tds[1].value.trim();
      const seedCorp = tds[2].value.trim();

      if (!crop) {
        validationErrors.push(`पंक्ति ${index + 1}: फसल का नाम आवश्यक है।`);
      }

      records.push({ crop, committee, seedCorp });
    });

    if (validationErrors.length) {
      alertBox.innerHTML = `<div class="alert alert-danger">${validationErrors.join('<br>')}</div>`;
      return;
    }

    // Log data — replace this with your supabase insert logic
    console.log('सबमिट किए गए रिकॉर्ड:', records);
    alertBox.innerHTML = '<div class="alert alert-success">डेटा सफलतापूर्वक सबमिट किया गया।</div>';
    tableBody.innerHTML = '';
    addRow();
  });

  // Add first empty row on load
  window.onload = () => addRow();
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
