<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ground Truth Survey | FASAL Project</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --primary-color: #800000;
            --secondary-color: #4d0000;
            --light-color: #ffffff;
            --dark-color: #333333;
            --gray-color: #f4f4f4;
            --border-color: #dddddd;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
            color: var(--dark-color);
        }
        
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .navbar-brand {
            font-weight: 700;
        }
        
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            margin-bottom: 20px;
            transition: transform 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-top-left-radius: 10px !important;
            border-top-right-radius: 10px !important;
            font-weight: 600;
        }
        
        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-primary:hover {
            background-color: var(--secondary-color);
            border-color: var(--secondary-color);
        }
        
        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(128, 0, 0, 0.25);
        }
        
        .required::after {
            content: " *";
            color: var(--primary-color);
        }
        
        .login-container {
            max-width: 400px;
            margin: 100px auto;
        }
        
        .dashboard-header {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid var(--primary-color);
        }
        
        .footer {
            background-color: #343a40;
            color: white;
            padding: 20px 0;
            margin-top: 50px;
        }
        
        #loadingSpinner {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }
        
        .tab-content {
            padding: 20px 0;
        }
        
        .nav-tabs .nav-link {
            color: var(--dark-color);
        }
        
        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            font-weight: 500;
        }

        .modal-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
        }

        .btn-close {
            filter: brightness(0) invert(1);
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div id="loadingSpinner">
        <div class="spinner-border text-light" role="status">
            <span class="visually-hidden">Loading...</span>
        </div>
    </div>

    <!-- Login Container -->
    <div class="container" id="loginContainer">
        <div class="login-container">
            <div class="card">
                <div class="card-header text-center">
                    <h4 class="mb-0">संचालनालय कृषि, छत्तीसगढ़</h4>
                </div>
                <div class="card-body">
                    <h5 class="text-center mb-4">Ground Truth Survey Portal</h5>
                    
                    <div class="alert alert-danger" id="loginAlert" style="display: none;">
                        <i class="fas fa-exclamation-circle"></i> Invalid username or password
                    </div>
                    
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label required">Username</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label required">Password</label>
                            <input type="password" class="form-control" id="password" required>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt me-2"></i> Login
                            </button>
                        </div>
                    </form>
                    
                    <div class="text-center mt-3">
                        <small>For technical support: Shailendra Singh Chauhan - 9399207068</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div id="mainContent" style="display: none;">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark">
            <div class="container">
                <a class="navbar-brand" href="#">FASAL Project</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#dashboard" data-bs-toggle="tab">Dashboard</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#officers" data-bs-toggle="tab">Officers</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#surveys" data-bs-toggle="tab">Surveys</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#reports" data-bs-toggle="tab">Reports</a>
                        </li>
                    </ul>
                    <div class="d-flex text-light align-items-center">
                        <div class="me-3">
                            <span id="userDisplayName">User</span>
                            <div class="small text-light opacity-75" id="userDivision">Division</div>
                        </div>
                        <button class="btn btn-outline-light btn-sm" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>
        </nav>

        <div class="container mt-4">
            <!-- Alerts -->
            <div class="alert alert-success alert-dismissible fade show" id="successAlert" style="display: none;">
                <i class="fas fa-check-circle me-2"></i>
                <span id="successMessage"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>
            
            <div class="alert alert-danger alert-dismissible fade show" id="errorAlert" style="display: none;">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span id="errorMessage"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Dashboard Tab -->
                <div class="tab-pane fade show active" id="dashboard">
                    <div class="dashboard-header">
                        <h4>Division wise plan & proposal of ground truth survey for kharif 2025 under FASAL Project</h4>
                        <p class="mb-0">संचालनालय कृषि, छत्तीसगढ़</p>
                    </div>

                    <div class="row">
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted">Total Officers</h6>
                                            <h3 id="totalOfficers">0</h3>
                                        </div>
                                        <i class="fas fa-user-tie fa-2x text-primary"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted">Total Surveys</h6>
                                            <h3 id="totalSurveys">0</h3>
                                        </div>
                                        <i class="fas fa-map-marked-alt fa-2x text-success"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted">Completed</h6>
                                            <h3 id="completedSurveys">0</h3>
                                        </div>
                                        <i class="fas fa-check-circle fa-2x text-info"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between">
                                        <div>
                                            <h6 class="text-muted">Budget</h6>
                                            <h3 id="totalBudget">₹0</h3>
                                        </div>
                                        <i class="fas fa-rupee-sign fa-2x text-warning"></i>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>Recent Survey Data</span>
                            <button class="btn btn-sm btn-outline-light" id="refreshDashboardBtn">
                                <i class="fas fa-sync-alt"></i> Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="recentSurveysTable">
                                    <thead>
                                        <tr>
                                            <th>Division</th>
                                            <th>Team</th>
                                            <th>Date</th>
                                            <th>Total</th>
                                            <th>Completed</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be populated from Supabase -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Officers Tab -->
                <div class="tab-pane fade" id="officers">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>अधिकारी व्यक्तिगत जानकारी</span>
                            <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#officerModal">
                                <i class="fas fa-plus"></i> Add New
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="officersTable">
                                    <thead>
                                        <tr>
                                            <th>Name</th>
                                            <th>Designation</th>
                                            <th>Division</th>
                                            <th>District</th>
                                            <th>Block</th>
                                            <th>Mobile</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be populated from Supabase -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Surveys Tab -->
                <div class="tab-pane fade" id="surveys">
                    <ul class="nav nav-tabs mb-3">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#groundTruth">Ground Truth</a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#cropAssessment">Crop Assessment</a>
                        </li>
                    </ul>
                    
                    <div class="tab-content">
                        <div class="tab-pane fade show active" id="groundTruth">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Ground Truth Survey Data</span>
                                    <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#groundTruthModal">
                                        <i class="fas fa-plus"></i> Add New
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="groundTruthTable">
                                            <thead>
                                                <tr>
                                                    <th>Division</th>
                                                    <th>Team</th>
                                                    <th>Date</th>
                                                    <th>Total</th>
                                                    <th>Completed</th>
                                                    <th>Expenditure</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be populated from Supabase -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="tab-pane fade" id="cropAssessment">
                            <div class="card">
                                <div class="card-header d-flex justify-content-between align-items-center">
                                    <span>Crop Assessment Data</span>
                                    <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#cropAssessmentModal">
                                        <i class="fas fa-plus"></i> Add New
                                    </button>
                                </div>
                                <div class="card-body">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="cropAssessmentTable">
                                            <thead>
                                                <tr>
                                                    <th>Division</th>
                                                    <th>District</th>
                                                    <th>Block</th>
                                                    <th>Village</th>
                                                    <th>Crop Type</th>
                                                    <th>Total</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be populated from Supabase -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div class="tab-pane fade" id="reports">
                    <div class="card">
                        <div class="card-header">Reports & Analytics</div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-4">
                                    <label for="reportType" class="form-label">Report Type</label>
                                    <select class="form-select" id="reportType">
                                        <option value="division">Division-wise Report</option>
                                        <option value="district">District-wise Report</option>
                                        <option value="officer">Officer-wise Report</option>
                                        <option value="budget">Budget Report</option>
                                    </select>
                                </div>
                                <div class="col-md-3">
                                    <label for="dateFrom" class="form-label">Date From</label>
                                    <input type="date" class="form-control" id="dateFrom">
                                </div>
                                <div class="col-md-3">
                                    <label for="dateTo" class="form-label">Date To</label>
                                    <input type="date" class="form-control" id="dateTo">
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button class="btn btn-primary w-100" id="generateReportBtn">Generate</button>
                                </div>
                            </div>
                            
                            <div id="reportResult">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Select report parameters and click Generate to view reports.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer">
            <div class="container">
                <div class="row">
                    <div class="col-md-6 text-center text-md-start">
                        <h6>संचालनालय कृषि, छत्तीसगढ़</h6>
                        <p class="small mb-0">Ground truth survey for kharif 2025 under FASAL Project</p>
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <p class="small mb-0">&copy; 2025 All Rights Reserved</p>
                        <p class="small mb-0">Support: Shailendra Singh Chauhan - 9399207068</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Officer Modal -->
    <div class="modal fade" id="officerModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="officerModalTitle">Add Officer</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="officerForm">
                        <input type="hidden" id="officerId">
                        <div class="mb-3">
                            <label for="officerName" class="form-label required">अधिकारी/कर्मचारी का नाम</label>
                            <input type="text" class="form-control" id="officerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="officerDesignation" class="form-label required">पदनाम</label>
                            <select class="form-select" id="officerDesignation" required>
                                <option value="">पदनाम चुनें</option>
                                <option value="R.A.EO">R.A.EO</option>
                                <option value="A.D.O">A.D.O</option>
                                <option value="S.D.A.O">S.D.A.O</option>
                                <option value="A.D.A">A.D.A</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="officerDivision" class="form-label required">संभाग</label>
                            <select class="form-select" id="officerDivision" required onchange="populateDistricts('officerDivision', 'officerDistrict')">
                                <option value="">संभाग चुनें</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="officerDistrict" class="form-label required">जिला</label>
                            <select class="form-select" id="officerDistrict" required onchange="populateBlocks('officerDistrict', 'officerBlock')">
                                <option value="">जिला चुनें</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="officerBlock" class="form-label required">विकासखंड</label>
                            <select class="form-select" id="officerBlock" required>
                                <option value="">विकासखंड चुनें</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="officerMobile" class="form-label required">मोबाइल नंबर</label>
                            <input type="tel" class="form-control" id="officerMobile" pattern="[0-9]{10}" required>
                        </div>
                        <div class="mb-3">
                            <label for="officerEmail" class="form-label">ईमेल (वैकल्पिक)</label>
                            <input type="email" class="form-control" id="officerEmail">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveOfficerBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ground Truth Modal -->
    <div class="modal fade" id="groundTruthModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="groundTruthModalTitle">Add Ground Truth Survey</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="groundTruthForm">
                        <input type="hidden" id="groundTruthId">
                        <div class="mb-3">
                            <label for="gtDivision" class="form-label required">संभाग का नाम</label>
                            <select class="form-select" id="gtDivision" required>
                                <option value="">संभाग चुनें</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="gtTeam" class="form-label required">दल क्रमांक</label>
                            <input type="number" class="form-control" id="gtTeam" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="gtOfficers" class="form-label required">दल में संबंधित अधिकारियों का नाम</label>
                            <input type="text" class="form-control" id="gtOfficers" required>
                        </div>
                        <div class="mb-3">
                            <label for="gtDate" class="form-label required">सर्वे दिनांक</label>
                            <input type="date" class="form-control" id="gtDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="gtTotalSurveys" class="form-label required">कुल सर्वे</label>
                            <input type="number" class="form-control" id="gtTotalSurveys" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="gtCompletedSurveys" class="form-label required">सम्पादित संख्या</label>
                            <input type="number" class="form-control" id="gtCompletedSurveys" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="gtExpenditure" class="form-label required">व्यय राशि (रूपये में)</label>
                            <input type="number" class="form-control" id="gtExpenditure" min="0" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="gtAmountDemanded" class="form-label required">कुल राशि की मांग</label>
                            <input type="number" class="form-control" id="gtAmountDemanded" min="0" step="0.01" required>
                        </div>
                        <div class="mb-3">
                            <label for="gtRemarks" class="form-label">रिमार्क</label>
                            <textarea class="form-control" id="gtRemarks" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveGroundTruthBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Crop Assessment Modal -->
    <div class="modal fade" id="cropAssessmentModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="cropAssessmentModalTitle">Add Crop Assessment</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cropAssessmentForm">
                        <input type="hidden" id="cropAssessmentId">
                        <div class="mb-3">
                            <label for="caDivision" class="form-label required">संभाग का नाम</label>
                            <select class="form-select" id="caDivision" required onchange="populateDistricts('caDivision', 'caDistrict')">
                                <option value="">संभाग चुनें</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="caDistrict" class="form-label required">जिला का नाम</label>
                            <select class="form-select" id="caDistrict" required onchange="populateBlocks('caDistrict', 'caBlock')">
                                <option value="">जिला चुनें</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="caBlock" class="form-label required">विकासखण्ड का नाम</label>
                            <select class="form-select" id="caBlock" required>
                                <option value="">विकासखंड चुनें</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="caVillage" class="form-label required">ग्राम का नाम</label>
                            <input type="text" class="form-control" id="caVillage" required>
                        </div>
                        <div class="mb-3">
                            <label for="caCropType" class="form-label required">फसल प्रकार</label>
                            <select class="form-select" id="caCropType" required>
                                <option value="">फसल प्रकार चुनें</option>
                                <option value="सिंचित">सिंचित</option>
                                <option value="असिंचित">असिंचित</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="caTotalSurveys" class="form-label required">कुल सर्वे</label>
                            <input type="number" class="form-control" id="caTotalSurveys" min="1" required>
                        </div>
                        <div class="mb-3">
                            <label for="caCompletedSurveys" class="form-label required">सम्पादित संख्या</label>
                            <input type="number" class="form-control" id="caCompletedSurveys" min="0" required>
                        </div>
                        <div class="mb-3">
                            <label for="caRemarks" class="form-label">रिमार्क</label>
                            <textarea class="form-control" id="caRemarks" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="saveCropAssessmentBtn">Save</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- Supabase -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // Initialize Supabase
        const supabaseUrl = 'https://txjbfqrbbtvzlxpeegkv.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4amJmcXJiYnR2emx4cGVlZ2t2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMTU2NTQsImV4cCI6MjA2ODY5MTY1NH0.sE5UbwEOSnd9ED-k_Ix5OfdZbf7dmwlHZSjQQrEAyCo';
        let supabaseClient;

        // Division and District data
        const divisionData = {
            1: "रायपुर संभाग",
            2: "दुर्ग संभाग",
            3: "बिलासपुर संभाग",
            4: "सरगुजा संभाग",
            5: "बस्तर संभाग",
            6: "प्रदेश"
        };

        const districtData = {
            1: { name: "रायपुर", division_id: 1 },
            2: { name: "गरियाबंद", division_id: 1 },
            3: { name: "बलौदाबाजार", division_id: 1 },
            4: { name: "महासमुंद", division_id: 1 },
            5: { name: "धमतरी", division_id: 1 },
            6: { name: "दुर्ग", division_id: 2 },
            7: { name: "बालोद", division_id: 2 },
            8: { name: "बेमेतरा", division_id: 2 },
            9: { name: "कबीरधाम", division_id: 2 },
            10: { name: "राजनांदगांव", division_id: 2 },
            11: { name: "खैरागढ़", division_id: 2 },
            12: { name: "मोहला", division_id: 2 },
            13: { name: "बिलासपुर", division_id: 3 },
            14: { name: "गौरेला-पेण्ड्रा-मरवाही", division_id: 3 },
            15: { name: "मुंगेली", division_id: 3 },
            16: { name: "जांजगीर", division_id: 3 },
            17: { name: "सक्ती", division_id: 3 },
            18: { name: "कोरबा", division_id: 3 },
            19: { name: "रायगढ़", division_id: 3 },
            20: { name: "सारंगढ़-बिलाईगढ़", division_id: 3 },
            21: { name: "सरगुजा", division_id: 4 },
            22: { name: "सूरजपुर", division_id: 4 },
            23: { name: "बलरामपुर", division_id: 4 },
            24: { name: "कोरिया", division_id: 4 },
            25: { name: "मनेन्द्रगढ़-चिरमिरी", division_id: 4 },
            26: { name: "जशपुर", division_id: 4 },
            27: { name: "जगदलपुर", division_id: 5 },
            28: { name: "कोण्डागांव", division_id: 5 },
            29: { name: "कांकेर", division_id: 5 },
            30: { name: "दंतेवाड़ा", division_id: 5 },
            31: { name: "सुकमा", division_id: 5 },
            32: { name: "बीजापुर", division_id: 5 },
            33: { name: "नारायणपुर", division_id: 5 }
        };

        // Block data
        const blockData = {
            1: ["अभनपुर", "आरंग", "धरसींवा", "तिल्दा"],
            2: ["गरियाबंद", "छुरा", "देवभोग", "मैनपुर", "फिंगेश्वर"],
            3: ["बलौदाबाजार", "भाटापारा", "कसडोल", "पलारी", "सिमगा"],
            4: ["महासमुंद", "बागबाहरा", "पिथौरा", "बसना", "सरायपाली"],
            5: ["धमतरी", "नगरी", "कुरुद", "मगरलोड"],
            6: ["दुर्ग", "धमधा", "पाटन"],
            7: ["बालोद", "गुंडरदेही", "डौंडी", "डौंडीलोहारा", "गुरुर"],
            8: ["बेमेतरा", "बेरला", "साजा", "नवागढ़"],
            9: ["कबीरधाम", "बोडला", "कवर्धा", "पण्डरिया", "एस.लोहारा"],
            10: ["राजनांदगांव", "छुरिया", "डोंगरगढ़", "डोंगरगाँव"],
            11: ["खैरागढ़", "छुईखदान"],
            12: ["मोहला", "अम्बागढ़ चौकी", "मानपुर"],
            13: ["बिलासपुर", "कोटा", "बेलहा", "मस्तूरी", "तखतपुर"],
            14: ["मरवाही", "गौरेला-1", "गौरेला-2"],
            15: ["मुंगेली", "लोरमी", "पथरिया"],
            16: ["जांजगीर", "अकलतरा", "बलौदा", "बमहनीडीह", "नवागढ़", "पामगढ़"],
            17: ["सक्ती", "मलखरौदा", "डभरा", "जयजयपुर"],
            18: ["कोरबा", "करतला", "कटघोरा", "पाली", "पोड़ी उपरोड़ा"],
            19: ["रायगढ़", "धरमजयगढ़", "घरघोड़ा", "खरसिया", "लैलूंगा", "पुसौर", "तमनार"],
            20: ["बारमकेला", "सारंगढ़", "बिलाईगढ़"],
            21: ["अंबिकापुर", "बतौली", "लखनपुर", "लुंड्रा", "मैनपाट", "सीतापुर", "उदयपुर"],
            22: ["सूरजपुर", "भैयाथान", "ओडगी", "प्रतापपुर", "प्रेमनगर", "रामानुजगंज"],
            23: ["बलरामपुर", "वाड्रफनगर", "कुसमी", "राजपुर", "रामचंद्रपुर", "शंकरगढ़"],
            24: ["बैकुंठपुर", "खड़गवाना", "सोनहत"],
            25: ["भरतपुर", "खड़गवाना", "मनेंद्रगढ़"],
            26: ["बगीचा", "दुलदुला", "फरसाबहार", "जशपुर", "कुनकुरी", "मनोरा", "पत्थलगांव"],
            27: ["बकावंड", "बस्तनार", "बस्तर", "दरभा", "जगदलपुर", "लोहंडीगुड़ा", "तोकापाल"],
            28: ["बड़ेराजपुर", "केशकाल", "कोंडागांव", "माकड़ी", "फरसगांव"],
            29: ["अंतागढ़", "भानुप्रतापपुर", "चारामा", "दुर्गूकोंडल", "कांकेर", "नरहरपुर", "कोयलीबेड़ा"],
            30: ["कुवाकोंडा", "दंतेवाड़ा", "गीदम", "कटेकल्याण"],
            31: ["छिंदगढ़", "सुकमा", "कोंटा"],
            32: ["भैरमगढ़", "भोपालपट्नम", "बीजापुर", "उसूर"],
            33: ["नारायणपुर", "ओरछा"]
        };

        // User data for authentication
        const users = {
            "raipur_admin": { password: "raipur123", name: "रायपुर संभाग प्रशासक", division: "रायपुर संभाग", division_id: 1 },
            "durg_admin": { password: "durg123", name: "दुर्ग संभाग प्रशासक", division: "दुर्ग संभाग", division_id: 2 },
            "bilaspur_admin": { password: "bilaspur123", name: "बिलासपुर संभाग प्रशासक", division: "बिलासपुर संभाग", division_id: 3 },
            "surguja_admin": { password: "surguja123", name: "सरगुजा संभाग प्रशासक", division: "सरगुजा संभाग", division_id: 4 },
            "bastar_admin": { password: "bastar123", name: "बस्तर संभाग प्रशासक", division: "बस्तर संभाग", division_id: 5 },
            "admin": { password: "admin123", name: "Admin User", division: "All Divisions", division_id: 0 }
        };

        // Current user
        let currentUser = null;

        // Document Ready
        document.addEventListener('DOMContentLoaded', function() {
            // Set up event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('logoutBtn').addEventListener('click', handleLogout);
            document.getElementById('refreshDashboardBtn').addEventListener('click', loadDashboardData);
            document.getElementById('generateReportBtn').addEventListener('click', generateReport);
            document.getElementById('saveOfficerBtn').addEventListener('click', saveOfficer);
            document.getElementById('saveGroundTruthBtn').addEventListener('click', saveGroundTruth);
            document.getElementById('saveCropAssessmentBtn').addEventListener('click', saveCropAssessment);
            
            // Initialize Supabase
            try {
                supabaseClient = supabase.createClient(supabaseUrl, supabaseKey);
                console.log("Supabase initialized successfully");
            } catch (error) {
                console.error("Error initializing Supabase:", error);
            }
        });

        // Handle login
        function handleLogin(e) {
            e.preventDefault();
            
            const username = document.getElementById('username').value.trim();
            const password = document.getElementById('password').value.trim();
            
            if (users[username] && users[username].password === password) {
                // Login successful
                currentUser = {
                    username: username,
                    ...users[username]
                };
                
                document.getElementById('userDisplayName').textContent = currentUser.name;
                document.getElementById('userDivision').textContent = currentUser.division;
                
                document.getElementById('loginContainer').style.display = 'none';
                document.getElementById('mainContent').style.display = 'block';
                
                // Populate division dropdowns
                populateDivisionDropdowns();
                
                // Load data
                loadDashboardData();
            } else {
                // Login failed
                document.getElementById('loginAlert').style.display = 'block';
                setTimeout(() => {
                    document.getElementById('loginAlert').style.display = 'none';
                }, 3000);
            }
        }

        // Handle logout
        function handleLogout() {
            currentUser = null;
            document.getElementById('mainContent').style.display = 'none';
            document.getElementById('loginContainer').style.display = 'block';
            document.getElementById('loginForm').reset();
        }

        // Show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }

        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }

        // Show success message
        function showSuccess(message) {
            document.getElementById('successMessage').textContent = message;
            document.getElementById('successAlert').style.display = 'block';
            setTimeout(() => {
                document.getElementById('successAlert').style.display = 'none';
            }, 3000);
        }

        // Show error message
        function showError(message) {
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorAlert').style.display = 'block';
            setTimeout(() => {
                document.getElementById('errorAlert').style.display = 'none';
            }, 3000);
        }

        // Populate all division dropdowns
        function populateDivisionDropdowns() {
            const divisionDropdowns = ['officerDivision', 'gtDivision', 'caDivision'];
            
            divisionDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    dropdown.innerHTML = '<option value="">संभाग चुनें</option>';
                    
                    // If user is division admin, only show their division
                    if (currentUser && currentUser.division_id !== 0) {
                        const option = document.createElement('option');
                        option.value = currentUser.division_id;
                        option.textContent = currentUser.division;
                        dropdown.appendChild(option);
                    } else {
                        // Admin can see all divisions
                        Object.entries(divisionData).forEach(([id, name]) => {
                            if (id != 6) { // Skip Pradesh
                                const option = document.createElement('option');
                                option.value = id;
                                option.textContent = name;
                                dropdown.appendChild(option);
                            }
                        });
                    }
                }
            });
        }

        // Populate districts based on division
        function populateDistricts(divisionSelectId, districtSelectId) {
            const divisionId = document.getElementById(divisionSelectId).value;
            const districtSelect = document.getElementById(districtSelectId);
            
            districtSelect.innerHTML = '<option value="">जिला चुनें</option>';
            
            if (!divisionId) return;
            
            Object.entries(districtData)
                .filter(([_, district]) => district.division_id == divisionId)
                .sort((a, b) => a[1].name.localeCompare(b[1].name))
                .forEach(([id, district]) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = district.name;
                    districtSelect.appendChild(option);
                });
        }

        // Populate blocks based on district
        function populateBlocks(districtSelectId, blockSelectId) {
            const districtId = document.getElementById(districtSelectId).value;
            const blockSelect = document.getElementById(blockSelectId);
            
            blockSelect.innerHTML = '<option value="">विकासखंड चुनें</option>';
            
            if (!districtId || !blockData[districtId]) return;
            
            blockData[districtId].forEach(block => {
                const option = document.createElement('option');
                option.value = block;
                option.textContent = block;
                blockSelect.appendChild(option);
            });
        }

        // Load dashboard data
        function loadDashboardData() {
            showLoading();
            
            setTimeout(() => {
                // Update summary cards
                document.getElementById('totalOfficers').textContent = '42';
                document.getElementById('totalSurveys').textContent = '156';
                document.getElementById('completedSurveys').textContent = '98';
                document.getElementById('totalBudget').textContent = '₹7,85,000';
                
                // Update recent surveys table
                const tableBody = document.getElementById('recentSurveysTable').getElementsByTagName('tbody')[0];
                tableBody.innerHTML = '';
                
                const recentSurveys = [
                    { division: currentUser.division, team: '1', date: '2025-07-15', total: 35, completed: 28, status: 'In Progress' },
                    { division: currentUser.division, team: '2', date: '2025-07-12', total: 42, completed: 42, status: 'Completed' }
                ];
                
                recentSurveys.forEach(survey => {
                    const row = tableBody.insertRow();
                    
                    // Division
                    let cell = row.insertCell();
                    cell.textContent = survey.division;
                    
                    // Team
                    cell = row.insertCell();
                    cell.textContent = survey.team;
                    
                    // Date
                    cell = row.insertCell();
                    const surveyDate = new Date(survey.date);
                    cell.textContent = surveyDate.toLocaleDateString('hi-IN');
                    
                    // Total
                    cell = row.insertCell();
                    cell.textContent = survey.total;
                    
                    // Completed
                    cell = row.insertCell();
                    cell.textContent = survey.completed;
                    
                    // Status
                    cell = row.insertCell();
                    let badge;
                    
                    if (survey.status === 'Completed') {
                        badge = '<span class="badge bg-success">पूर्ण</span>';
                    } else if (survey.status === 'In Progress') {
                        badge = '<span class="badge bg-warning">प्रगति में</span>';
                    } else {
                        badge = '<span class="badge bg-secondary">शुरू नहीं</span>';
                    }
                    
                    cell.innerHTML = badge;
                });
                
                hideLoading();
                showSuccess('डैशबोर्ड अपडेट किया गया!');
            }, 1000);
        }

        // Save officer data
        function saveOfficer() {
            const form = document.getElementById('officerForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showSuccess('अधिकारी की जानकारी सफलतापूर्वक सहेजी गई!');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('officerModal'));
                modal.hide();
                
                // Reset form
                form.reset();
            }, 1000);
        }

        // Save ground truth survey data
        function saveGroundTruth() {
            const form = document.getElementById('groundTruthForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showSuccess('Ground Truth Survey डेटा सफलतापूर्वक सहेजा गया!');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('groundTruthModal'));
                modal.hide();
                
                // Reset form
                form.reset();
            }, 1000);
        }

        // Save crop assessment data
        function saveCropAssessment() {
            const form = document.getElementById('cropAssessmentForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                showSuccess('Crop Assessment डेटा सफलतापूर्वक सहेजा गया!');
                
                // Close modal
                const modal = bootstrap.Modal.getInstance(document.getElementById('cropAssessmentModal'));
                modal.hide();
                
                // Reset form
                form.reset();
            }, 1000);
        }

        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('dateFrom').value;
            const dateTo = document.getElementById('dateTo').value;
            
            if (!dateFrom || !dateTo) {
                showError('कृपया रिपोर्ट के लिए तारीख का चयन करें।');
                return;
            }
            
            showLoading();
            
            setTimeout(() => {
                hideLoading();
                
                // Generate sample report HTML
                let reportHtml = `
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>${reportType.charAt(0).toUpperCase() + reportType.slice(1)}-wise Report (${dateFrom} to ${dateTo})</span>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary me-2">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-sm btn-outline-success">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>क्र.सं.</th>
                                            <th>${reportType === 'division' ? 'संभाग' : reportType === 'district' ? 'जिला' : reportType === 'officer' ? 'अधिकारी' : 'बजट'}</th>
                                            <th>कुल सर्वे</th>
                                            <th>पूर्ण</th>
                                            <th>प्रतिशत</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>${currentUser.division}</td>
                                            <td>156</td>
                                            <td>98</td>
                                            <td>62.8%</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('reportResult').innerHTML = reportHtml;
                showSuccess('रिपोर्ट जनरेट किया गया!');
            }, 1000);
        }
    </script>
</body>
</html>

                        
