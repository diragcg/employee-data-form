<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ground Truth Survey for Kharif 2025 | FASAL Project</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- DataTables CSS -->
    <link rel="stylesheet" href="https://cdn.datatables.net/1.13.6/css/dataTables.bootstrap5.min.css">
    <link rel="stylesheet" href="https://cdn.datatables.net/buttons/2.4.1/css/buttons.bootstrap5.min.css">
    
    <!-- Supabase JS Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <!-- Custom CSS -->
    <style>
        :root {
            --primary-color: #800000; /* Maroon Red */
            --secondary-color: #4d0000; /* Darker Maroon */
            --accent-color: #ff9999; /* Light Red */
            --text-color: #333333; /* Dark Gray for text */
            --light-color: #ffffff; /* White */
            --gray-color: #f4f4f4; /* Light Gray */
            --border-color: #dddddd; /* Border color */
            --shadow-color: rgba(0, 0, 0, 0.2); /* Shadow color */
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f8f9fa;
        }

        /* 3D Card Effect */
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.1);
            transition: all 0.3s;
            transform-style: preserve-3d;
            margin-bottom: 30px;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0,0,0,0.2);
        }

        .card-header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-top-left-radius: 10px !important;
            border-top-right-radius: 10px !important;
            font-weight: 600;
            padding: 15px 20px;
        }

        .card-header i {
            margin-right: 10px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            border: none;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: all 0.3s;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            transform: translateY(-2px);
            box-shadow: 0 6px 8px rgba(0,0,0,0.15);
        }

        .btn-secondary {
            background: #6c757d;
            border: none;
        }

        /* Custom navbar */
        .navbar {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 15px 0;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .navbar-brand {
            color: white;
            font-weight: 700;
            font-size: 1.5rem;
        }

        .nav-link {
            color: rgba(255,255,255,0.85) !important;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-link:hover {
            color: white !important;
            transform: translateY(-2px);
        }

        .nav-link.active {
            color: white !important;
            border-bottom: 2px solid white;
        }

        /* Login form */
        .login-container {
            max-width: 450px;
            margin: 80px auto;
        }

        /* Form styling */
        .form-label {
            font-weight: 500;
            margin-bottom: 8px;
        }

        .form-control:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 0.25rem rgba(128, 0, 0, 0.25);
        }

        .required::after {
            content: " *";
            color: var(--primary-color);
            font-weight: bold;
        }

        /* Dashboard header */
        .dashboard-header {
            background: linear-gradient(135deg, #f8f9fa, #e9ecef);
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid var(--primary-color);
        }

        .dashboard-header h2 {
            margin: 0;
            color: var(--primary-color);
            font-weight: 600;
        }

        /* Table styling */
        .table-container {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.08);
            margin-bottom: 30px;
        }

        /* Footer */
        .footer {
            background: #343a40;
            color: white;
            padding: 20px 0;
            text-align: center;
            margin-top: 50px;
        }

        /* Loading spinner */
        .spinner-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .spinner-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.2);
            text-align: center;
        }

        /* Tab styling */
        .nav-tabs .nav-link {
            color: var(--text-color);
            border: none;
            padding: 12px 20px;
            font-weight: 500;
        }

        .nav-tabs .nav-link.active {
            color: var(--primary-color);
            border-bottom: 3px solid var(--primary-color);
            background-color: transparent;
        }

        .nav-tabs .nav-link:hover:not(.active) {
            border-bottom: 3px solid #dee2e6;
        }

        /* Print styles */
        @media print {
            .no-print {
                display: none !important;
            }
            
            body {
                background-color: white !important;
            }
            
            .card {
                box-shadow: none !important;
                border: 1px solid #ddd !important;
            }
            
            .card-header {
                background: white !important;
                color: black !important;
                border-bottom: 1px solid #ddd !important;
            }
            
            .table-container {
                box-shadow: none !important;
            }
        }
    </style>
</head>
<body>
    <!-- Loading Spinner -->
    <div class="spinner-overlay" id="loadingSpinner">
        <div class="spinner-container">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
            </div>
            <p class="mt-2">प्रक्रिया जारी है, कृपया प्रतीक्षा करें...</p>
        </div>
    </div>

    <!-- Login Modal -->
    <div class="modal fade" id="loginModal" data-bs-backdrop="static" tabindex="-1" aria-labelledby="loginModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-maroon text-white" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));">
                    <h5 class="modal-title" id="loginModalLabel">संचालनालय कृषि, छत्तीसगढ़</h5>
                </div>
                <div class="modal-body">
                    <div class="text-center mb-4">
                        <h4>Ground Truth Survey Portal</h4>
                        <p>कृपया लॉगिन करें</p>
                    </div>
                    
                    <div class="alert alert-danger" id="loginError" style="display: none;">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <span id="loginErrorMessage">Invalid username or password.</span>
                    </div>
                    
                    <form id="loginForm">
                        <div class="mb-3">
                            <label for="username" class="form-label required">Username</label>
                            <input type="text" class="form-control" id="username" required>
                        </div>
                        <div class="mb-3">
                            <label for="password" class="form-label required">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3 form-check">
                            <input type="checkbox" class="form-check-input" id="rememberMe">
                            <label class="form-check-label" for="rememberMe">Remember me</label>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-sign-in-alt me-2"></i> Login
                            </button>
                        </div>
                    </form>
                    
                    <div class="text-center mt-3">
                        <small>For technical support: Shailendra Singh Chauhan - 9399207068</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content (initially hidden) -->
    <div id="mainContent" style="display: none;">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg navbar-dark sticky-top">
            <div class="container">
                <a class="navbar-brand" href="#">FASAL Project</a>
                <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                    <span class="navbar-toggler-icon"></span>
                </button>
                <div class="collapse navbar-collapse" id="navbarNav">
                    <ul class="navbar-nav me-auto">
                        <li class="nav-item">
                            <a class="nav-link active" href="#" data-bs-toggle="tab" data-bs-target="#dashboardTab">
                                <i class="fas fa-tachometer-alt me-1"></i> Dashboard
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="tab" data-bs-target="#officersTab">
                                <i class="fas fa-user-tie me-1"></i> Officers
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="tab" data-bs-target="#surveysTab">
                                <i class="fas fa-map-marked-alt me-1"></i> Surveys
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="#" data-bs-toggle="tab" data-bs-target="#reportsTab">
                                <i class="fas fa-chart-bar me-1"></i> Reports
                            </a>
                        </li>
                    </ul>
                    <div class="d-flex align-items-center">
                        <div class="text-light me-3">
                            <small>Welcome,</small>
                            <span class="ms-1 fw-bold" id="userDisplayName">User</span>
                            <div class="small text-light opacity-75" id="userDivisionName">Division</div>
                        </div>
                        <div class="dropdown">
                            <button class="btn btn-outline-light btn-sm dropdown-toggle" type="button" id="userMenuButton" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="fas fa-user-circle"></i>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userMenuButton">
                                <li><a class="dropdown-item" href="#" id="profileLink"><i class="fas fa-id-card me-2"></i>Profile</a></li>
                                <li><a class="dropdown-item" href="#" id="changePasswordLink"><i class="fas fa-key me-2"></i>Change Password</a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item" href="#" id="logoutBtn"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Container -->
        <div class="container mt-4">
            <!-- Alert Messages -->
            <div class="alert alert-success alert-dismissible fade show" id="successAlert" style="display: none;" role="alert">
                <i class="fas fa-check-circle me-2"></i>
                <span id="successMessage"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
            
            <div class="alert alert-danger alert-dismissible fade show" id="errorAlert" style="display: none;" role="alert">
                <i class="fas fa-exclamation-circle me-2"></i>
                <span id="errorMessage"></span>
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>

            <!-- Tab Content -->
            <div class="tab-content">
                <!-- Dashboard Tab -->
                <div class="tab-pane fade show active" id="dashboardTab">
                    <div class="dashboard-header">
                        <div class="row align-items-center">
                            <div class="col-md-8">
                                <h2>Division wise plan & proposal of ground truth survey for kharif 2025 under FASAL Project</h2>
                                <p class="text-muted mb-0">संचालनालय कृषि, छत्तीसगढ़</p>
                            </div>
                            <div class="col-md-4 text-md-end">
                                <span class="badge bg-primary mb-2">Kharif 2025</span>
                                <p class="small mb-0" id="currentDate">Today's Date</p>
                            </div>
                        </div>
                    </div>

                    <!-- Summary Cards -->
                    <div class="row">
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-muted mb-0">Total Officers</h6>
                                            <h2 class="mt-2 mb-0" id="totalOfficers">0</h2>
                                        </div>
                                        <div class="bg-light p-3 rounded">
                                            <i class="fas fa-user-tie text-primary fa-2x"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 5px;">
                                        <div class="progress-bar bg-primary" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-muted mb-0">Total Surveys</h6>
                                            <h2 class="mt-2 mb-0" id="totalSurveys">0</h2>
                                        </div>
                                        <div class="bg-light p-3 rounded">
                                            <i class="fas fa-map-marked-alt text-success fa-2x"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 5px;">
                                        <div class="progress-bar bg-success" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-muted mb-0">Completed Surveys</h6>
                                            <h2 class="mt-2 mb-0" id="completedSurveys">0</h2>
                                        </div>
                                        <div class="bg-light p-3 rounded">
                                            <i class="fas fa-check-circle text-info fa-2x"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 5px;">
                                        <div class="progress-bar bg-info" role="progressbar" id="completedSurveysProgress" style="width: 0%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3 mb-4">
                            <div class="card h-100">
                                <div class="card-body">
                                    <div class="d-flex justify-content-between align-items-center">
                                        <div>
                                            <h6 class="card-title text-muted mb-0">Total Budget</h6>
                                            <h2 class="mt-2 mb-0" id="totalBudget">₹0</h2>
                                        </div>
                                        <div class="bg-light p-3 rounded">
                                            <i class="fas fa-rupee-sign text-warning fa-2x"></i>
                                        </div>
                                    </div>
                                    <div class="progress mt-3" style="height: 5px;">
                                        <div class="progress-bar bg-warning" role="progressbar" style="width: 100%"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Recent Survey Data -->
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-list"></i> Recent Survey Data</span>
                            <button class="btn btn-sm btn-outline-light" id="refreshDashboardBtn">
                                <i class="fas fa-sync-alt me-1"></i> Refresh
                            </button>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover" id="recentSurveysTable">
                                    <thead>
                                        <tr>
                                            <th>Division</th>
                                            <th>Team</th>
                                            <th>Survey Date</th>
                                            <th>Total Surveys</th>
                                            <th>Completed</th>
                                            <th>Status</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be populated dynamically -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Officers Tab -->
                <div class="tab-pane fade" id="officersTab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-user-tie"></i> अधिकारी व्यक्तिगत जानकारी</span>
                            <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#officerFormModal">
                                <i class="fas fa-plus me-1"></i> Add New
                            </button>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-4" id="officersTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="officersListTab" data-bs-toggle="tab" data-bs-target="#officersList" type="button" role="tab">
                                        <i class="fas fa-list me-1"></i> Officers List
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="officersTrainingTab" data-bs-toggle="tab" data-bs-target="#officersTraining" type="button" role="tab">
                                        <i class="fas fa-chalkboard-teacher me-1"></i> Training Status
                                    </button>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="officersList" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="officersTable">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Designation</th>
                                                    <th>Division</th>
                                                    <th>District</th>
                                                    <th>Block</th>
                                                    <th>Mobile</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be populated dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="officersTraining" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="trainingTable">
                                            <thead>
                                                <tr>
                                                    <th>Name</th>
                                                    <th>Designation</th>
                                                    <th>Division</th>
                                                    <th>Training Date</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be populated dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Surveys Tab -->
                <div class="tab-pane fade" id="surveysTab">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span><i class="fas fa-map-marked-alt"></i> Ground Truth Survey Data</span>
                            <div>
                                <button class="btn btn-sm btn-outline-light me-2" data-bs-toggle="modal" data-bs-target="#groundTruthFormModal">
                                    <i class="fas fa-plus me-1"></i> Add Survey
                                </button>
                                <button class="btn btn-sm btn-outline-light" data-bs-toggle="modal" data-bs-target="#cropAssessmentFormModal">
                                    <i class="fas fa-seedling me-1"></i> Add Assessment
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <ul class="nav nav-tabs mb-4" id="surveysTabs" role="tablist">
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link active" id="groundTruthTab" data-bs-toggle="tab" data-bs-target="#groundTruth" type="button" role="tab">
                                        <i class="fas fa-map me-1"></i> Ground Truth Survey
                                    </button>
                                </li>
                                <li class="nav-item" role="presentation">
                                    <button class="nav-link" id="cropAssessmentTab" data-bs-toggle="tab" data-bs-target="#cropAssessment" type="button" role="tab">
                                        <i class="fas fa-seedling me-1"></i> Crop Assessment
                                    </button>
                                </li>
                            </ul>
                            
                            <div class="tab-content">
                                <div class="tab-pane fade show active" id="groundTruth" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="groundTruthTable">
                                            <thead>
                                                <tr>
                                                    <th>Division</th>
                                                    <th>Team</th>
                                                    <th>Officers</th>
                                                    <th>Survey Date</th>
                                                    <th>Total Surveys</th>
                                                    <th>Expenditure</th>
                                                    <th>Demanded</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be populated dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="tab-pane fade" id="cropAssessment" role="tabpanel">
                                    <div class="table-responsive">
                                        <table class="table table-hover" id="cropAssessmentTable">
                                            <thead>
                                                <tr>
                                                    <th>Division</th>
                                                    <th>Team</th>
                                                    <th>District</th>
                                                    <th>Block</th>
                                                    <th>Village</th>
                                                    <th>Crop Type</th>
                                                    <th>Total Surveys</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody>
                                                <!-- Data will be populated dynamically -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Reports Tab -->
                <div class="tab-pane fade" id="reportsTab">
                    <div class="card">
                        <div class="card-header">
                            <i class="fas fa-chart-bar"></i> Reports & Analytics
                        </div>
                        <div class="card-body">
                            <div class="row mb-4">
                                <div class="col-md-4">
                                    <div class="form-group">
                                        <label for="reportType" class="form-label">Report Type</label>
                                        <select class="form-select" id="reportType">
                                            <option value="division">Division-wise Report</option>
                                            <option value="district">District-wise Report</option>
                                            <option value="officer">Officer-wise Report</option>
                                            <option value="budget">Budget Report</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="reportDateFrom" class="form-label">Date From</label>
                                        <input type="date" class="form-control" id="reportDateFrom">
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="form-group">
                                        <label for="reportDateTo" class="form-label">Date To</label>
                                        <input type="date" class="form-control" id="reportDateTo">
                                    </div>
                                </div>
                                <div class="col-md-2 d-flex align-items-end">
                                    <button class="btn btn-primary w-100" id="generateReportBtn">
                                        <i class="fas fa-file-alt me-2"></i> Generate
                                    </button>
                                </div>
                            </div>
                            
                            <div id="reportResult" class="mt-4">
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Select report parameters and click Generate to view reports.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer class="footer mt-5 py-3 bg-dark">
            <div class="container">
                <div class="row">
                      <div class="col-md-6 text-center text-md-start">
                        <h6 class="text-white">संचालनालय कृषि, छत्तीसगढ़</h6>
                        <p class="text-white-50 small mb-0">Division wise plan & proposal of ground truth survey for kharif 2025 under FASAL Project</p>
                    </div>
                    <div class="col-md-6 text-center text-md-end">
                        <p class="text-white-50 small mb-0">&copy; 2025 All Rights Reserved</p>
                        <p class="text-white-50 small mb-0">Technical Support: Shailendra Singh Chauhan - 9399207068</p>
                    </div>
                </div>
            </div>
        </footer>
    </div>

    <!-- Officer Form Modal -->
    <div class="modal fade" id="officerFormModal" tabindex="-1" aria-labelledby="officerFormModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
                    <h5 class="modal-title" id="officerFormModalLabel">अधिकारी व्यक्तिगत जानकारी फॉर्म</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="officerForm">
                        <input type="hidden" id="officerId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="officerName" class="form-label required">अधिकारी/कर्मचारी का नाम</label>
                                <input type="text" class="form-control" id="officerName" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="officerDesignation" class="form-label required">पदनाम</label>
                                <select class="form-select" id="officerDesignation" required>
                                    <option value="">पदनाम चुनें</option>
                                    <option value="R.A.EO">R.A.EO</option>
                                    <option value="A.D.O">A.D.O</option>
                                    <option value="S.D.A.O">S.D.A.O</option>
                                    <option value="A.D.A">A.D.A</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="officerDivision" class="form-label required">संभाग</label>
                                <select class="form-select" id="officerDivision" required onchange="populateOfficerDistricts()">
                                    <option value="">संभाग चुनें</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="officerDistrict" class="form-label required">जिला</label>
                                <select class="form-select" id="officerDistrict" required onchange="populateOfficerBlocks()">
                                    <option value="">जिला चुनें</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="officerBlock" class="form-label required">विकासखंड</label>
                                <select class="form-select" id="officerBlock" required>
                                    <option value="">विकासखंड चुनें</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="officerTeam" class="form-label required">दल क्रमांक</label>
                                <input type="number" class="form-control" id="officerTeam" min="1" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="officerMobile" class="form-label required">मोबाइल नंबर</label>
                                <input type="tel" class="form-control" id="officerMobile" pattern="[0-9]{10}" required>
                                <small class="form-text text-muted">10 अंकों का मोबाइल नंबर दर्ज करें</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="officerEmail" class="form-label">ईमेल (वैकल्पिक)</label>
                                <input type="email" class="form-control" id="officerEmail">
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> रद्द करें
                    </button>
                    <button type="button" class="btn btn-primary" id="saveOfficerBtn">
                        <i class="fas fa-save me-1"></i> जमा करें
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Ground Truth Survey Form Modal -->
    <div class="modal fade" id="groundTruthFormModal" tabindex="-1" aria-labelledby="groundTruthFormModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
                    <h5 class="modal-title" id="groundTruthFormModalLabel">Ground Truth Survey प्रस्ताव</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="groundTruthForm">
                        <input type="hidden" id="groundTruthId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="gtsDivision" class="form-label required">संभाग का नाम</label>
                                <select class="form-select" id="gtsDivision" required>
                                    <option value="">संभाग चुनें</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gtsTeam" class="form-label required">दल क्रमांक</label>
                                <input type="number" class="form-control" id="gtsTeam" min="1" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="gtsOfficers" class="form-label required">दल में संबंधित अधिकारियों का नाम</label>
                                <input type="text" class="form-control" id="gtsOfficers" required>
                                <small class="form-text text-muted">अधिकारियों के नाम कॉमा से अलग करें</small>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gtsDate" class="form-label required">सर्वे दिनांक</label>
                                <input type="date" class="form-control" id="gtsDate" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="gtsTotalSurveys" class="form-label required">कुल सर्वे</label>
                                <input type="number" class="form-control" id="gtsTotalSurveys" min="1" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gtsExpenditure" class="form-label required">व्यय राशि (रूपये में)</label>
                                <input type="number" class="form-control" id="gtsExpenditure" min="0" step="0.01" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="gtsAmountDemanded" class="form-label required">कुल राशि की मांग</label>
                                <input type="number" class="form-control" id="gtsAmountDemanded" min="0" step="0.01" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gtsCropSurveys" class="form-label required">फसल सर्वे कुल संख्या</label>
                                <input type="number" class="form-control" id="gtsCropSurveys" min="0" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="gtsCompletedSurveys" class="form-label required">सम्पादित संख्या</label>
                                <input type="number" class="form-control" id="gtsCompletedSurveys" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="gtsRemarks" class="form-label">रिमार्क</label>
                                <textarea class="form-control" id="gtsRemarks" rows="2"></textarea>
                            </div>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> रद्द करें
                    </button>
                    <button type="button" class="btn btn-primary" id="saveGroundTruthBtn">
                        <i class="fas fa-save me-1"></i> जमा करें
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Crop Assessment Form Modal -->
    <div class="modal fade" id="cropAssessmentFormModal" tabindex="-1" aria-labelledby="cropAssessmentFormModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
                    <h5 class="modal-title" id="cropAssessmentFormModalLabel">Kharif 2025 Crop Assessment</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="cropAssessmentForm">
                        <input type="hidden" id="cropAssessmentId">
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="caDivision" class="form-label required">संभाग का नाम</label>
                                <select class="form-select" id="caDivision" required onchange="populateCaDistricts()">
                                    <option value="">संभाग चुनें</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="caTeam" class="form-label required">दल क्रमांक</label>
                                <input type="number" class="form-control" id="caTeam" min="1" required>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-12 mb-3">
                                <label for="caOfficers" class="form-label required">दल में संबंधित अधिकारियों का नाम</label>
                                <input type="text" class="form-control" id="caOfficers" required>
                                <small class="form-text text-muted">अधिकारियों के नाम कॉमा से अलग करें</small>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="caDistrict" class="form-label required">जिला का नाम</label>
                                <select class="form-select" id="caDistrict" required onchange="populateCaBlocks()">
                                    <option value="">जिला चुनें</option>
                                </select>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="caBlock" class="form-label required">विकासखण्ड का नाम</label>
                                <select class="form-select" id="caBlock" required>
                                    <option value="">विकासखण्ड चुनें</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="caVillage" class="form-label required">ग्राम का नाम</label>
                                <input type="text" class="form-control" id="caVillage" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="caCrop" class="form-label required">फसल धान सिंचित/असिंचित</label>
                                <select class="form-select" id="caCrop" required>
                                    <option value="">फसल प्रकार चुनें</option>
                                    <option value="सिंचित">सिंचित</option>
                                    <option value="असिंचित">असिंचित</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6 mb-3">
                                <label for="caTotalSurveys" class="form-label required">फसल सर्वे कुल संख्या</label>
                                <input type="number" class="form-control" id="caTotalSurveys" min="0" required>
                            </div>
                            <div class="col-md-6 mb-3">
                                <label for="caCompletedSurveys" class="form-label required">सम्पादित संख्या</label>
                                <input type="number" class="form-control" id="caCompletedSurveys" min="0" required>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="caRemarks" class="form-label">रिमार्क</label>
                            <textarea class="form-control" id="caRemarks" rows="2"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-times me-1"></i> रद्द करें
                    </button>
                    <button type="button" class="btn btn-primary" id="saveCropAssessmentBtn">
                        <i class="fas fa-save me-1"></i> जमा करें
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header" style="background: linear-gradient(135deg, var(--primary-color), var(--secondary-color)); color: white;">
                    <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="changePasswordForm">
                        <div class="mb-3">
                            <label for="currentPassword" class="form-label required">Current Password</label>
                            <input type="password" class="form-control" id="currentPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="newPassword" class="form-label required">New Password</label>
                            <input type="password" class="form-control" id="newPassword" required>
                        </div>
                        <div class="mb-3">
                            <label for="confirmPassword" class="form-label required">Confirm New Password</label>
                            <input type="password" class="form-control" id="confirmPassword" required>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" id="savePasswordBtn">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS, Popper.js, and jQuery -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>
    
    <!-- DataTables JS -->
    <script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/1.13.6/js/dataTables.bootstrap5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/dataTables.buttons.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.bootstrap5.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.4.1/js/buttons.print.min.js"></script>
    
    <script>
        // Initialize Supabase client
        const supabaseUrl = 'https://txjbfqrbbtvzlxpeegkv.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4amJmcXJiYnR2emx4cGVlZ2t2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMTU2NTQsImV4cCI6MjA2ODY5MTY1NH0.sE5UbwEOSnd9ED-k_Ix5OfdZbf7dmwlHZSjQQrEAyCo';
        const supabase = supabase.createClient(supabaseUrl, supabaseKey);

        // Division and District data mapping
        const divisionData = {
            1: "रायपुर संभाग",
            2: "दुर्ग संभाग",
            3: "बिलासपुर संभाग",
            4: "सरगुजा संभाग",
            5: "बस्तर संभाग",
            6: "प्रदेश"
        };

        const districtData = {
            1: { name: "रायपुर", division_id: 1 },
            2: { name: "गरियाबंद", division_id: 1 },
            3: { name: "बलौदाबाजार", division_id: 1 },
            4: { name: "महासमुंद", division_id: 1 },
            5: { name: "धमतरी", division_id: 1 },
            6: { name: "दुर्ग", division_id: 2 },
            7: { name: "बालोद", division_id: 2 },
            8: { name: "बेमेतरा", division_id: 2 },
            9: { name: "कबीरधाम", division_id: 2 },
            10: { name: "राजनांदगांव", division_id: 2 },
            11: { name: "खैरागढ़", division_id: 2 },
            12: { name: "मोहला", division_id: 2 },
            13: { name: "बिलासपुर", division_id: 3 },
            14: { name: "गौरेला-पेण्ड्रा-मरवाही", division_id: 3 },
            15: { name: "मुंगेली", division_id: 3 },
            16: { name: "जांजगीर", division_id: 3 },
            17: { name: "सक्ती", division_id: 3 },
            18: { name: "कोरबा", division_id: 3 },
            19: { name: "रायगढ़", division_id: 3 },
            20: { name: "सारंगढ़-बिलाईगढ़", division_id: 3 },
            21: { name: "सरगुजा", division_id: 4 },
            22: { name: "सूरजपुर", division_id: 4 },
            23: { name: "बलरामपुर", division_id: 4 },
            24: { name: "कोरिया", division_id: 4 },
            25: { name: "मनेन्द्रगढ़-चिरमिरी", division_id: 4 },
            26: { name: "जशपुर", division_id: 4 },
            27: { name: "जगदलपुर", division_id: 5 },
            28: { name: "कोण्डागांव", division_id: 5 },
            29: { name: "कांकेर", division_id: 5 },
            30: { name: "दंतेवाड़ा", division_id: 5 },
            31: { name: "सुकमा", division_id: 5 },
            32: { name: "बीजापुर", division_id: 5 },
            33: { name: "नारायणपुर", division_id: 5 }
        };

        // Block data
        const blockData = {
            1: ["अभनपुर", "आरंग", "धरसींवा", "तिल्दा"],
            2: ["गरियाबंद", "छुरा", "देवभोग", "मैनपुर", "फिंगेश्वर"],
            3: ["बलौदाबाजार", "भाटापारा", "कसडोल", "पलारी", "सिमगा"],
            4: ["महासमुंद", "बागबाहरा", "पिथौरा", "बसना", "सरायपाली"],
            5: ["धमतरी", "नगरी", "कुरुद", "मगरलोड"],
            6: ["दुर्ग", "धमधा", "पाटन"],
            7: ["बालोद", "गुंडरदेही", "डौंडी", "डौंडीलोहारा", "गुरुर"],
            8: ["बेमेतरा", "बेरला", "साजा", "नवागढ़"],
            9: ["कबीरधाम", "बोडला", "कवर्धा", "पण्डरिया", "एस.लोहारा"],
            10: ["राजनांदगांव", "छुरिया", "डोंगरगढ़", "डोंगरगाँव"],
            11: ["खैरागढ़", "छुईखदान"],
            12: ["मोहला", "अम्बागढ़ चौकी", "मानपुर"],
            13: ["बिलासपुर", "कोटा", "बेलहा", "मस्तूरी", "तखतपुर"],
            14: ["मरवाही", "गौरेला-1", "गौरेला-2"],
            15: ["मुंगेली", "लोरमी", "पथरिया"],
            16: ["जांजगीर", "अकलतरा", "बलौदा", "बमहनीडीह", "नवागढ़", "पामगढ़"],
            17: ["सक्ती", "मलखरौदा", "डभरा", "जयजयपुर"],
            18: ["कोरबा", "करतला", "कटघोरा", "पाली", "पोड़ी उपरोड़ा"],
            19: ["रायगढ़", "धरमजयगढ़", "घरघोड़ा", "खरसिया", "लैलूंगा", "पुसौर", "तमनार"],
            20: ["बारमकेला", "सारंगढ़", "बिलाईगढ़"],
            21: ["अंबिकापुर", "बतौली", "लखनपुर", "लुंड्रा", "मैनपाट", "सीतापुर", "उदयपुर"],
            22: ["सूरजपुर", "भैयाथान", "ओडगी", "प्रतापपुर", "प्रेमनगर", "रामानुजगंज"],
            23: ["बलरामपुर", "वाड्रफनगर", "कुसमी", "राजपुर", "रामचंद्रपुर", "शंकरगढ़"],
            24: ["बैकुंठपुर", "खड़गवाना", "सोनहत"],
            25: ["भरतपुर", "खड़गवाना", "मनेंद्रगढ़"],
            26: ["बगीचा", "दुलदुला", "फरसाबहार", "जशपुर", "कुनकुरी", "मनोरा", "पत्थलगांव"],
            27: ["बकावंड", "बस्तनार", "बस्तर", "दरभा", "जगदलपुर", "लोहंडीगुड़ा", "तोकापाल"],
            28: ["बड़ेराजपुर", "केशकाल", "कोंडागांव", "माकड़ी", "फरसगांव"],
            29: ["अंतागढ़", "भानुप्रतापपुर", "चारामा", "दुर्गूकोंडल", "कांकेर", "नरहरपुर", "कोयलीबेड़ा"],
            30: ["कुवाकोंडा", "दंतेवाड़ा", "गीदम", "कटेकल्याण"],
            31: ["छिंदगढ़", "सुकमा", "कोंटा"],
            32: ["भैरमगढ़", "भोपालपट्नम", "बीजापुर", "उसूर"],
            33: ["नारायणपुर", "ओरछा"]
        };

        // User data (division-specific)
        const userData = {
            "raipur_admin": { 
                password: "raipur123", 
                name: "रायपुर संभाग प्रशासक", 
                division_id: 1, 
                division_name: "रायपुर संभाग", 
                role: "division_admin" 
            },
            "durg_admin": { 
                password: "durg123", 
                name: "दुर्ग संभाग प्रशासक", 
                division_id: 2, 
                division_name: "दुर्ग संभाग", 
                role: "division_admin" 
            },
            "bilaspur_admin": { 
                password: "bilaspur123", 
                name: "बिलासपुर संभाग प्रशासक", 
                division_id: 3, 
                division_name: "बिलासपुर संभाग", 
                role: "division_admin" 
            },
            "surguja_admin": { 
                password: "surguja123", 
                name: "सरगुजा संभाग प्रशासक", 
                division_id: 4, 
                division_name: "सरगुजा संभाग", 
                role: "division_admin" 
            },
            "bastar_admin": { 
                password: "bastar123", 
                name: "बस्तर संभाग प्रशासक", 
                division_id: 5, 
                division_name: "बस्तर संभाग", 
                role: "division_admin" 
            },
            "cg_admin": { 
                password: "admin123", 
                name: "छत्तीसगढ़ प्रशासक", 
                division_id: 6, 
                division_name: "प्रदेश", 
                role: "admin" 
            }
        };

        // Current user data (will be set after login)
        let currentUser = null;

        // Document ready
        document.addEventListener('DOMContentLoaded', function() {
            // Set current date
            const today = new Date();
            document.getElementById('currentDate').textContent = today.toLocaleDateString('hi-IN', {
                day: 'numeric',
                month: 'long',
                year: 'numeric'
            });

            // Show login modal
            const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
            loginModal.show();

            // Setup event listeners
            setupEventListeners();
            
            // Populate division dropdowns
            populateDivisionDropdowns();
        });

        // Setup event listeners
        function setupEventListeners() {
            // Toggle password visibility
            document.getElementById('togglePassword').addEventListener('click', function() {
                const passwordInput = document.getElementById('password');
                const icon = this.querySelector('i');
                
                if (passwordInput.type === 'password') {
                    passwordInput.type = 'text';
                    icon.classList.remove('fa-eye');
                    icon.classList.add('fa-eye-slash');
                } else {
                    passwordInput.type = 'password';
                    icon.classList.remove('fa-eye-slash');
                    icon.classList.add('fa-eye');
                }
            });

            // Login form submission
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const username = document.getElementById('username').value.trim();
                const password = document.getElementById('password').value.trim();
                
                if (userData[username] && userData[username].password === password) {
                    // Set current user
                    currentUser = {
                        username: username,
                        ...userData[username]
                    };
                    
                    // Update UI with user info
                    document.getElementById('userDisplayName').textContent = currentUser.name;
                    document.getElementById('userDivisionName').textContent = currentUser.division_name;
                    
                    // Hide login modal and show main content
                    bootstrap.Modal.getInstance(document.getElementById('loginModal')).hide();
                    document.getElementById('mainContent').style.display = 'block';
                    
                    // Load dashboard data
                    loadDashboardData();
                } else {
                    // Show error
                    document.getElementById('loginError').style.display = 'block';
                    document.getElementById('loginErrorMessage').textContent = 'Invalid username or password. Please try again.';
                }
            });

            // Logout button
            document.getElementById('logoutBtn').addEventListener('click', function(e) {
                e.preventDefault();
                
                // Clear current user
                currentUser = null;
                
                // Hide main content and show login modal
                document.getElementById('mainContent').style.display = 'none';
                const loginModal = new bootstrap.Modal(document.getElementById('loginModal'));
                loginModal.show();
                
                // Reset login form
                document.getElementById('loginForm').reset();
                document.getElementById('loginError').style.display = 'none';
            });

            // Officer form save button
            document.getElementById('saveOfficerBtn').addEventListener('click', function() {
                saveOfficerData();
            });

            // Ground Truth form save button
            document.getElementById('saveGroundTruthBtn').addEventListener('click', function() {
                saveGroundTruthData();
            });

            // Crop Assessment form save button
            document.getElementById('saveCropAssessmentBtn').addEventListener('click', function() {
                saveCropAssessmentData();
            });

            // Change password save button
            document.getElementById('savePasswordBtn').addEventListener('click', function() {
                changePassword();
            });

            // Change password link
            document.getElementById('changePasswordLink').addEventListener('click', function(e) {
                e.preventDefault();
                const changePasswordModal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
                changePasswordModal.show();
            });

            // Refresh dashboard button
            document.getElementById('refreshDashboardBtn').addEventListener('click', function() {
                loadDashboardData();
            });

            // Generate report button
            document.getElementById('generateReportBtn').addEventListener('click', function() {
                generateReport();
            });
        }

        // Populate all division dropdowns
        function populateDivisionDropdowns() {
            const divisionDropdowns = [
                'officerDivision', 'gtsDivision', 'caDivision', 'tr_division'
            ];
            
            divisionDropdowns.forEach(dropdownId => {
                const dropdown = document.getElementById(dropdownId);
                if (dropdown) {
                    dropdown.innerHTML = '<option value="">संभाग चुनें</option>';
                    
                    // If user is division admin, only show their division
                    if (currentUser && currentUser.role === 'division_admin') {
                        const option = document.createElement('option');
                        option.value = currentUser.division_id;
                        option.textContent = currentUser.division_name;
                        dropdown.appendChild(option);
                    } else {
                        // Admin can see all divisions
                        Object.entries(divisionData).forEach(([id, name]) => {
                            const option = document.createElement('option');
                            option.value = id;
                            option.textContent = name;
                            dropdown.appendChild(option);
                        });
                    }
                }
            });
        }

        // Populate districts based on selected division
        function populateOfficerDistricts() {
            const divisionId = document.getElementById('officerDivision').value;
            populateDistricts(divisionId, 'officerDistrict');
        }

        function populateCaDistricts() {
            const divisionId = document.getElementById('caDivision').value;
            populateDistricts(divisionId, 'caDistrict');
        }

        function populateDistricts(divisionId, districtDropdownId) {
            const districtDropdown = document.getElementById(districtDropdownId);
            
            districtDropdown.innerHTML = '<option value="">जिला चुनें</option>';
            
            if (!divisionId) return;
            
            // Filter districts by division_id
            Object.entries(districtData)
                .filter(([_, district]) => district.division_id == divisionId)
                .sort((a, b) => a[1].name.localeCompare(b[1].name))
                .forEach(([id, district]) => {
                    const option = document.createElement('option');
                    option.value = id;
                    option.textContent = district.name;
                    districtDropdown.appendChild(option);
                });
        }

        // Populate blocks based on selected district
        function populateOfficerBlocks() {
            const districtId = document.getElementById('officerDistrict').value;
            populateBlocks(districtId, 'officerBlock');
        }

        function populateCaBlocks() {
            const districtId = document.getElementById('caDistrict').value;
            populateBlocks(districtId, 'caBlock');
        }

        function populateBlocks(districtId, blockDropdownId) {
            const blockDropdown = document.getElementById(blockDropdownId);
            
            blockDropdown.innerHTML = '<option value="">विकासखंड चुनें</option>';
            
            if (!districtId || !blockData[districtId]) return;
            
            blockData[districtId].forEach(blockName => {
                const option = document.createElement('option');
                option.value = blockName;
                option.textContent = blockName;
                blockDropdown.appendChild(option);
            });
        }

        // Show loading spinner
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'flex';
        }

        // Hide loading spinner
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }

        // Show success alert
        function showSuccess(message) {
            const successAlert = document.getElementById('successAlert');
            document.getElementById('successMessage').textContent = message;
            successAlert.style.display = 'block';
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                successAlert.style.display = 'none';
            }, 3000);
        }

        // Show error alert
        function showError(message) {
            const errorAlert = document.getElementById('errorAlert');
            document.getElementById('errorMessage').textContent = message;
            errorAlert.style.display = 'block';
            
            // Auto hide after 5 seconds
            setTimeout(() => {
                errorAlert.style.display = 'none';
            }, 5000);
        }

        // Load dashboard data
        function loadDashboardData() {
            showLoading();
            
            // Simulated data loading (replace with actual Supabase calls)
            setTimeout(() => {
                // Update summary cards
                document.getElementById('totalOfficers').textContent = '42';
                document.getElementById('totalSurveys').textContent = '156';
                document.getElementById('completedSurveys').textContent = '98';
                document.getElementById('completedSurveysProgress').style.width = '63%';
                document.getElementById('totalBudget').textContent = '₹ 7,85,000';
                
                // Update recent surveys table
                const recentSurveysTable = document.getElementById('recentSurveysTable').getElementsByTagName('tbody')[0];
                recentSurveysTable.innerHTML = '';
                
                // Sample data (replace with data from Supabase)
                const sampleData = [
                    { division: 'रायपुर संभाग', team: '1', date: '15-07-2025', total: '35', completed: '28', status: 'In Progress' },
                    { division: 'दुर्ग संभाग', team: '2', date: '12-07-2025', total: '42', completed: '42', status: 'Completed' },
                    { division: 'बिलासपुर संभाग', team: '1', date: '18-07-2025', total: '30', completed: '12', status: 'In Progress' },
                    { division: 'सरगुजा संभाग', team: '3', date: '10-07-2025', total: '25', completed: '16', status: 'In Progress' },
                    { division: 'बस्तर संभाग', team: '1', date: '20-07-2025', total: '24', completed: '0', status: 'Not Started' }
                ];
                
                sampleData.forEach(data => {
                    const row = recentSurveysTable.insertRow();
                    
                    const divisionCell = row.insertCell(0);
                    divisionCell.textContent = data.division;
                    
                    const teamCell = row.insertCell(1);
                    teamCell.textContent = data.team;
                    
                    const dateCell = row.insertCell(2);
                    dateCell.textContent = data.date;
                    
                    const totalCell = row.insertCell(3);
                    totalCell.textContent = data.total;
                    
                    const completedCell = row.insertCell(4);
                    completedCell.textContent = data.completed;
                    
                    const statusCell = row.insertCell(5);
                    let statusBadge;
                    
                    if (data.status === 'Completed') {
                        statusBadge = '<span class="badge bg-success">पूर्ण</span>';
                    } else if (data.status === 'In Progress') {
                        statusBadge = '<span class="badge bg-warning">प्रगति में</span>';
                    } else {
                        statusBadge = '<span class="badge bg-secondary">शुरू नहीं</span>';
                    }
                    
                    statusCell.innerHTML = statusBadge;
                });
                
                hideLoading();
            }, 800);
        }

        // Save officer data
        function saveOfficerData() {
            // Validate form
            const form = document.getElementById('officerForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            showLoading();
            
            // Get form values
            const officerId = document.getElementById('officerId').value;
            const formData = {
                name: document.getElementById('officerName').value,
                designation: document.getElementById('officerDesignation').value,
                division_id: document.getElementById('officerDivision').value,
                division_name: document.getElementById('officerDivision').options[document.getElementById('officerDivision').selectedIndex].text,
                district_id: document.getElementById('officerDistrict').value,
                district_name: document.getElementById('officerDistrict').options[document.getElementById('officerDistrict').selectedIndex].text,
                block_name: document.getElementById('officerBlock').value,
                team_number: document.getElementById('officerTeam').value,
                mobile_number: document.getElementById('officerMobile').value,
                email: document.getElementById('officerEmail').value || null,
                created_at: new Date().toISOString()
            };
            
            // Simulated save operation (replace with actual Supabase call)
            setTimeout(() => {
                hideLoading();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('officerFormModal')).hide();
                
                // Show success message
                showSuccess('अधिकारी की जानकारी सफलतापूर्वक सहेजी गई!');
                
                // Reset form
                document.getElementById('officerForm').reset();
                document.getElementById('officerId').value = '';
                
                // Refresh data (in a real app, you would reload the officers list)
            }, 800);
        }

        // Save ground truth survey data
        function saveGroundTruthData() {
            // Validate form
            const form = document.getElementById('groundTruthForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            showLoading();
            
            // Get form values
            const groundTruthId = document.getElementById('groundTruthId').value;
            const formData = {
                division_id: document.getElementById('gtsDivision').value,
                division_name: document.getElementById('gtsDivision').options[document.getElementById('gtsDivision').selectedIndex].text,
                team_number: document.getElementById('gtsTeam').value,
                officer_names: document.getElementById('gtsOfficers').value,
                survey_date: document.getElementById('gtsDate').value,
                total_surveys: document.getElementById('gtsTotalSurveys').value,
                expenditure_amount: document.getElementById('gtsExpenditure').value,
                total_amount_demanded: document.getElementById('gtsAmountDemanded').value,
                total_crop_surveys: document.getElementById('gtsCropSurveys').value,
                completed_surveys: document.getElementById('gtsCompletedSurveys').value,
                remarks: document.getElementById('gtsRemarks').value || null,
                created_at: new Date().toISOString()
            };
            
            // Simulated save operation (replace with actual Supabase call)
            setTimeout(() => {
                hideLoading();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('groundTruthFormModal')).hide();
                
                // Show success message
                showSuccess('Ground Truth Survey डेटा सफलतापूर्वक सहेजा गया!');
                
                // Reset form
                document.getElementById('groundTruthForm').reset();
                document.getElementById('groundTruthId').value = '';
                
                // Refresh dashboard data
                loadDashboardData();
            }, 800);
        }

        // Save crop assessment data
        function saveCropAssessmentData() {
            // Validate form
            const form = document.getElementById('cropAssessmentForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }
            
            showLoading();
            
            // Get form values
            const cropAssessmentId = document.getElementById('cropAssessmentId').value;
            const formData = {
                division_id: document.getElementById('caDivision').value,
                division_name: document.getElementById('caDivision').options[document.getElementById('caDivision').selectedIndex].text,
                team_number: document.getElementById('caTeam').value,
                officer_names: document.getElementById('caOfficers').value,
                district_id: document.getElementById('caDistrict').value,
                district_name: document.getElementById('caDistrict').options[document.getElementById('caDistrict').selectedIndex].text,
                block_name: document.getElementById('caBlock').value,
                village_name: document.getElementById('caVillage').value,
                crop_irrigation_status: document.getElementById('caCrop').value,
                total_crop_surveys: document.getElementById('caTotalSurveys').value,
                completed_surveys: document.getElementById('caCompletedSurveys').value,
                remarks: document.getElementById('caRemarks').value || null,
                assessment_date: new Date().toISOString().split('T')[0],
                created_at: new Date().toISOString()
            };
            
            // Simulated save operation (replace with actual Supabase call)
            setTimeout(() => {
                hideLoading();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('cropAssessmentFormModal')).hide();
                
                // Show success message
                showSuccess('Crop Assessment डेटा सफलतापूर्वक सहेजा गया!');
                
                // Reset form
                document.getElementById('cropAssessmentForm').reset();
                document.getElementById('cropAssessmentId').value = '';
                
                // Refresh dashboard data
                loadDashboardData();
            }, 800);
        }

        // Change password
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Validate passwords
            if (!currentPassword || !newPassword || !confirmPassword) {
                showError('All fields are required');
                return;
            }
            
            if (newPassword !== confirmPassword) {
                showError('New password and confirm password do not match');
                return;
            }
            
            // Check current password
            if (currentUser && userData[currentUser.username].password !== currentPassword) {
                showError('Current password is incorrect');
                return;
            }
            
            showLoading();
            
            // Simulated password change (in a real app, you would update the password in Supabase)
            setTimeout(() => {
                // Update password in userData (for demo purposes only)
                userData[currentUser.username].password = newPassword;
                
                hideLoading();
                
                // Close modal
                bootstrap.Modal.getInstance(document.getElementById('changePasswordModal')).hide();
                
                // Show success message
                showSuccess('Password changed successfully');
                
                // Reset form
                document.getElementById('changePasswordForm').reset();
            }, 800);
        }

        // Generate report
        function generateReport() {
            const reportType = document.getElementById('reportType').value;
            const dateFrom = document.getElementById('reportDateFrom').value;
            const dateTo = document.getElementById('reportDateTo').value;
            
            if (!dateFrom || !dateTo) {
                showError('Please select date range for the report');
                return;
            }
            
            showLoading();
            
            // Simulated report generation (replace with actual data from Supabase)
            setTimeout(() => {
                hideLoading();
                
                const reportResult = document.getElementById('reportResult');
                
                // Sample report HTML
                let reportHtml = `
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <span>${reportType.charAt(0).toUpperCase() + reportType.slice(1)}-wise Report (${dateFrom} to ${dateTo})</span>
                            <div>
                                <button class="btn btn-sm btn-outline-secondary me-2" onclick="exportToPDF()">
                                    <i class="fas fa-file-pdf me-1"></i> PDF
                                </button>
                                <button class="btn btn-sm btn-outline-success" onclick="exportToExcel()">
                                    <i class="fas fa-file-excel me-1"></i> Excel
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-bordered table-striped">
                                    <thead>
                                        <tr>
                                            <th>क्र.सं.</th>
                                            <th>${reportType === 'division' ? 'संभाग का नाम' : reportType === 'district' ? 'जिला का नाम' : 'अधिकारी का नाम'}</th>
                                            <th>कुल सर्वे</th>
                                            <th>पूर्ण सर्वे</th>
                                            <th>प्रतिशत</th>
                                            ${reportType === 'budget' ? '<th>व्यय राशि</th><th>मांग राशि</th>' : ''}
                                        </tr>
                                    </thead>
                                    <tbody>`;
                
                // Generate sample data based on report type
                if (reportType === 'division') {
                    Object.entries(divisionData).forEach(([id, name], index) => {
                        if (id != 6) { // Skip Pradesh
                            const totalSurveys = Math.floor(Math.random() * 50) + 20;
                            const completedSurveys = Math.floor(Math.random() * totalSurveys);
                            const percentage = Math.round((completedSurveys / totalSurveys) * 100);
                            
                            reportHtml += `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${name}</td>
                                    <td>${totalSurveys}</td>
                                    <td>${completedSurveys}</td>
                                    <td>${percentage}%</td>
                                </tr>`;
                        }
                    });
                } else if (reportType === 'district') {
                    Object.entries(districtData).forEach(([id, district], index) => {
                        const totalSurveys = Math.floor(Math.random() * 30) + 10;
                        const completedSurveys = Math.floor(Math.random() * totalSurveys);
                        const percentage = Math.round((completedSurveys / totalSurveys) * 100);
                        
                        reportHtml += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${district.name}</td>
                                <td>${totalSurveys}</td>
                                <td>${completedSurveys}</td>
                                <td>${percentage}%</td>
                            </tr>`;
                    });
                } else if (reportType === 'officer') {
                    const sampleOfficers = [
                        'राजेश कुमार', 'अनिल शर्मा', 'सुनीता वर्मा', 'प्रमोद सिंह', 
                        'मनोज यादव', 'सविता देवी', 'विनोद पटेल', 'अमित कुमार'
                    ];
                    
                    sampleOfficers.forEach((name, index) => {
                        const totalSurveys = Math.floor(Math.random() * 20) + 5;
                        const completedSurveys = Math.floor(Math.random() * totalSurveys);
                        const percentage = Math.round((completedSurveys / totalSurveys) * 100);
                        
                        reportHtml += `
                            <tr>
                                <td>${index + 1}</td>
                                <td>${name}</td>
                                <td>${totalSurveys}</td>
                                <td>${completedSurveys}</td>
                                <td>${percentage}%</td>
                            </tr>`;
                    });
                } else if (reportType === 'budget') {
                    Object.entries(divisionData).forEach(([id, name], index) => {
                        if (id != 6) { // Skip Pradesh
                            const totalSurveys = Math.floor(Math.random() * 50) + 20;
                            const completedSurveys = Math.floor(Math.random() * totalSurveys);
                            const percentage = Math.round((completedSurveys / totalSurveys) * 100);
                            const expenditure = Math.floor(Math.random() * 50000) + 30000;
                            const demanded = Math.floor(Math.random() * 100000) + 50000;
                            
                            reportHtml += `
                                <tr>
                                    <td>${index + 1}</td>
                                    <td>${name}</td>
                                    <td>${totalSurveys}</td>
                                    <td>${completedSurveys}</td>
                                    <td>${percentage}%</td>
                                    <td>₹ ${expenditure.toLocaleString('en-IN')}</td>
                                    <td>₹ ${demanded.toLocaleString('en-IN')}</td>
                                </tr>`;
                        }
                    });
                }
                
                reportHtml += `
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                `;
                
                reportResult.innerHTML = reportHtml;
            }, 1000);
        }

        // Export to PDF function (placeholder)
        function exportToPDF() {
            alert('PDF export functionality would be implemented here');
            // In a real application, you would use a library like jsPDF to generate the PDF
        }

        // Export to Excel function (placeholder)
        function exportToExcel() {
            alert('Excel export functionality would be implemented here');
            // In a real application, you would use a library like SheetJS to generate the Excel file
        }
    </script>
</body>
</html>


