<!DOCTYPE html>
<html lang="hi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generate Report - DBT Data Entry System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Mukti:wght@200;300;400;500;600;700;800&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        :root {
            --admin-primary: #1B5E20;
            --admin-secondary: #2E7D32;
            --admin-accent: #4CAF50;
            --text-dark: #1A1A1A;
            --text-medium: #666666;
            --text-light: #fff;
            --background-light: #FAFAFA;
            --border-color: #E5E5E5;
            --shadow-sm: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            --shadow-md: 0 8px 24px rgba(0, 0, 0, 0.12);
            --shadow-lg: 0 8px 24px rgba(27, 94, 32, 0.2);
            --dbt-blue: #0D47A1;
            --dbt-light-blue: #E3F2FD;
            --danger-color: #dc3545;
            --success-color: #28a745;
            --warning-color: #ffc107;
            --info-color: #17a2b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Mukti', sans-serif;
            background: linear-gradient(135deg, var(--background-light) 0%, var(--text-light) 100%);
            min-height: 100vh;
            color: var(--text-dark);
        }

        .hindi {
            font-weight: 500;
            letter-spacing: 0.3px;
            line-height: 1.5;
        }

        /* Header Styles */
        .header {
            background: linear-gradient(135deg, var(--admin-primary) 0%, var(--admin-secondary) 100%);
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 3px solid var(--admin-accent);
        }
        
        .navbar {
            padding: 12px 0;
        }
        
        .navbar-brand {
            font-weight: 700;
            font-size: 1.3rem;
            color: var(--text-light);
            display: flex;
            align-items: center;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .navbar-brand img {
            height: 40px;
            margin-right: 12px;
        }

        .btn-back {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-weight: 500;
        }

        .btn-back:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.5);
            color: white;
            transform: translateY(-1px);
        }

        /* Main Container */
        .main-container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        /* Page Header */
        .page-header {
            background: linear-gradient(135deg, var(--dbt-blue) 0%, #1565C0 100%);
            color: white;
            padding: 25px 30px;
            border-radius: 12px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-md);
        }

        .page-header h2 {
            font-weight: 700;
            margin: 0 0 10px 0;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
        }

        /* Report Builder */
        .report-builder {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            overflow: hidden;
            margin-bottom: 20px;
        }

        .builder-header {
            background: linear-gradient(135deg, var(--background-light) 0%, #F5F5F5 100%);
            padding: 20px 25px;
            border-bottom: 2px solid var(--border-color);
        }

        .builder-content {
            padding: 25px;
        }

        .step-indicator {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
        }

        .step {
            display: flex;
            align-items: center;
            margin: 0 10px;
        }

        .step-number {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background: var(--border-color);
            color: var(--text-medium);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            margin-right: 10px;
            transition: all 0.3s ease;
        }

        .step.active .step-number {
            background: var(--dbt-blue);
            color: white;
        }

        .step.completed .step-number {
            background: var(--success-color);
            color: white;
        }

        .step-title {
            font-weight: 600;
            color: var(--text-medium);
        }

        .step.active .step-title {
            color: var(--dbt-blue);
        }

        .step.completed .step-title {
            color: var(--success-color);
        }

        .step-connector {
            width: 50px;
            height: 2px;
            background: var(--border-color);
            margin: 0 10px;
        }

        .step.completed + .step .step-connector {
            background: var(--success-color);
        }

        /* Form Steps */
        .form-step {
            display: none;
        }

        .form-step.active {
            display: block;
            animation: fadeIn 0.3s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .form-section {
            margin-bottom: 25px;
        }

        .section-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }

        .section-title i {
            margin-right: 10px;
            color: var(--dbt-blue);
        }

        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 8px;
            display: block;
        }

        .form-control, .form-select {
            border-radius: 8px;
            border: 2px solid var(--border-color);
            padding: 12px 15px;
            transition: all 0.2s ease;
            width: 100%;
        }

        .form-control:focus, .form-select:focus {
            outline: none;
            border-color: var(--dbt-blue);
            box-shadow: 0 0 0 3px rgba(13, 71, 161, 0.1);
        }

        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }

        .checkbox-item {
            display: flex;
            align-items: center;
            padding: 10px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            transition: all 0.2s ease;
            cursor: pointer;
        }

        .checkbox-item:hover {
            border-color: var(--dbt-blue);
            background: var(--dbt-light-blue);
        }

        .checkbox-item input[type="checkbox"] {
            margin-right: 10px;
        }

        .checkbox-item.checked {
            border-color: var(--dbt-blue);
            background: var(--dbt-light-blue);
        }

        /* Report Template Cards */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .template-card {
            border: 2px solid var(--border-color);
            border-radius: 12px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .template-card:hover {
            border-color: var(--dbt-blue);
            transform: translateY(-3px);
            box-shadow: var(--shadow-md);
        }

        .template-card.selected {
            border-color: var(--dbt-blue);
            background: var(--dbt-light-blue);
        }

        .template-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: var(--dbt-blue);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-bottom: 15px;
        }

        .template-title {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--text-dark);
            margin-bottom: 8px;
        }

        .template-description {
            color: var(--text-medium);
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .template-features {
            margin-top: 15px;
        }

        .template-features ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .template-features li {
            padding: 3px 0;
            font-size: 0.85rem;
            color: var(--text-medium);
        }

        .template-features li:before {
            content: "✓";
            color: var(--success-color);
            font-weight: bold;
            margin-right: 8px;
        }

        /* Preview Section */
        .preview-section {
            background: white;
            border-radius: 12px;
            box-shadow: var(--shadow);
            margin-bottom: 20px;
        }

        .preview-header {
            background: linear-gradient(135deg, var(--background-light) 0%, #F5F5F5 100%);
            padding: 20px 25px;
            border-bottom: 2px solid var(--border-color);
            display: flex;
            justify-content: between;
            align-items: center;
        }

        .preview-content {
            padding: 25px;
            max-height: 500px;
            overflow-y: auto;
        }

        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .preview-table th,
        .preview-table td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .preview-table th {
            background: var(--dbt-light-blue);
            color: var(--dbt-blue);
            font-weight: 600;
        }

        .preview-chart {
            text-align: center;
            padding: 40px;
            color: var(--text-medium);
        }

        /* Navigation Buttons */
        .step-navigation {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 2px solid var(--border-color);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--dbt-blue) 0%, #1565C0 100%);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #1565C0 0%, var(--dbt-blue) 100%);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: var(--text-medium);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
        }

        .btn-secondary:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success-color);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.2s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-success:hover {
            background: #218838;
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Loading States */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            display: none;
        }

        .loading-spinner {
            background: white;
            padding: 40px;
            border-radius: 12px;
            text-align: center;
            box-shadow: var(--shadow-lg);
        }

        .progress-section {
            margin: 20px 0;
        }

        .progress-bar-custom {
            height: 20px;
            background: var(--border-color);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, var(--dbt-blue) 0%, #1565C0 100%);
            transition: width 0.3s ease;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.9rem;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .main-container {
                padding: 0 15px;
            }

            .step-indicator {
                flex-direction: column;
                align-items: center;
            }

            .step {
                margin: 5px 0;
            }

            .step-connector {
                display: none;
            }

            .form-grid {
                grid-template-columns: 1fr;
            }

            .template-grid {
                grid-template-columns: 1fr;
            }

            .step-navigation {
                flex-direction: column;
                gap: 10px;
            }
        }

        /* Print Styles */
        @media print {
            .header, .btn-back, .step-indicator, .step-navigation {
                display: none !important;
            }
            
            .main-container {
                max-width: none;
                margin: 0;
                padding: 0;
            }
            
            .report-builder, .preview-section {
                box-shadow: none;
                border: 1px solid #ddd;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container-fluid">
            <nav class="navbar navbar-expand-lg navbar-dark">
                <div class="container-fluid">
                    <a class="navbar-brand" href="#">
                        <img src="https://upload.wikimedia.org/wikipedia/commons/8/87/Coat_of_arms_of_Chhattisgarh.svg" alt="छत्तीसगढ़ सरकार">
                        <span class="hindi">Generate Report - DBT System</span>
                    </a>
                    
                    <div class="d-flex align-items-center gap-3">
                        <a href="index.html" class="btn-back">
                            <i class="fas fa-home me-2"></i>
                            <span class="hindi">Home</span>
                        </a>
                        <button onclick="history.back()" class="btn-back">
                            <i class="fas fa-arrow-left me-2"></i>
                            <span class="hindi">Back</span>
                        </button>
                        <div class="dropdown">
                            <button class="btn btn-outline-light dropdown-toggle" type="button" id="userDropdown" data-bs-toggle="dropdown">
                                <i class="fas fa-user me-2"></i>
                                <span id="userInfo">Loading...</span>
                            </button>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="profile.html">
                                    <i class="fas fa-user-circle me-2"></i>Profile
                                </a></li>
                                <li><a class="dropdown-item" href="data-reports.html">
                                    <i class="fas fa-chart-bar me-2"></i>All Reports
                                </a></li>
                                <li><hr class="dropdown-divider"></li>
                                <li><a class="dropdown-item text-danger" href="#" onclick="logout()">
                                    <i class="fas fa-sign-out-alt me-2"></i>Logout
                                </a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </nav>
        </div>
    </header>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner">
            <div class="spinner-border text-primary mb-3" role="status"></div>
            <div class="hindi" id="loadingText">Generating report...</div>
            <div class="progress-section" id="progressSection" style="display: none;">
                <div class="progress-bar-custom">
                    <div class="progress-fill" id="progressFill" style="width: 0%;">0%</div>
                </div>
                <div class="text-muted" id="progressText">Initializing...</div>
            </div>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Page Header -->
        <div class="page-header">
            <h2>
                <i class="fas fa-file-export me-3"></i>
                <span class="hindi">Generate Custom Report</span>
            </h2>
            <p class="mb-0 opacity-75">Create comprehensive reports with customizable parameters and formats</p>
        </div>

        <!-- Report Builder -->
        <div class="report-builder">
            <div class="builder-header">
                <h5>
                    <i class="fas fa-magic me-2"></i>
                    Report Builder
                </h5>
            </div>
            
            <div class="builder-content">
                <!-- Step Indicator -->
                <div class="step-indicator">
                    <div class="step active" id="step1">
                        <div class="step-number">1</div>
                        <div class="step-title">Template</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" id="step2">
                        <div class="step-number">2</div>
                        <div class="step-title">Parameters</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" id="step3">
                        <div class="step-number">3</div>
                        <div class="step-title">Filters</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" id="step4">
                        <div class="step-number">4</div>
                        <div class="step-title">Preview</div>
                    </div>
                    <div class="step-connector"></div>
                    <div class="step" id="step5">
                        <div class="step-number">5</div>
                        <div class="step-title">Generate</div>
                    </div>
                </div>

                <!-- Step 1: Template Selection -->
                <div class="form-step active" id="formStep1">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-file-alt"></i>
                            Choose Report Template
                        </div>
                        <div class="template-grid">
                            <div class="template-card" onclick="selectTemplate('summary')">
                                <div class="template-icon">
                                    <i class="fas fa-chart-pie"></i>
                                </div>
                                <div class="template-title">Summary Report</div>
                                <div class="template-description">Comprehensive overview of all DBT activities with key metrics and statistics.</div>
                                <div class="template-features">
                                    <ul>
                                        <li>Total entries and amounts</li>
                                        <li>Approval rates and trends</li>
                                        <li>Beneficiary statistics</li>
                                        <li>Performance indicators</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="template-card" onclick="selectTemplate('scheme')">
                                <div class="template-icon">
                                    <i class="fas fa-list-alt"></i>
                                </div>
                                <div class="template-title">Scheme-wise Analysis</div>
                                <div class="template-description">Detailed performance analysis for individual government schemes.</div>
                                <div class="template-features">
                                    <ul>
                                        <li>Scheme performance metrics</li>
                                        <li>Budget utilization</li>
                                        <li>Beneficiary distribution</li>
                                        <li>Comparative analysis</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="template-card" onclick="selectTemplate('district')">
                                <div class="template-icon">
                                    <i class="fas fa-map-marker-alt"></i>
                                </div>
                                <div class="template-title">District Performance</div>
                                <div class="template-description">Geographic analysis of DBT implementation across districts.</div>
                                <div class="template-features">
                                    <ul>
                                        <li>District-wise metrics</li>
                                        <li>Geographic distribution</li>
                                        <li>Regional comparisons</li>
                                        <li>Performance rankings</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="template-card" onclick="selectTemplate('financial')">
                                <div class="template-icon">
                                    <i class="fas fa-rupee-sign"></i>
                                </div>
                                <div class="template-title">Financial Analysis</div>
                                <div class="template-description">Comprehensive financial breakdown and budget analysis.</div>
                                <div class="template-features">
                                    <ul>
                                        <li>Budget vs actual</li>
                                        <li>Fund utilization</li>
                                        <li>Cost analysis</li>
                                        <li>Financial trends</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="template-card" onclick="selectTemplate('beneficiary')">
                                <div class="template-icon">
                                    <i class="fas fa-users"></i>
                                </div>
                                <div class="template-title">Beneficiary Report</div>
                                <div class="template-description">Detailed analysis of beneficiary data and demographics.</div>
                                <div class="template-features">
                                    <ul>
                                        <li>Beneficiary demographics</li>
                                        <li>Impact assessment</li>
                                        <li>Coverage analysis</li>
                                        <li>Success stories</li>
                                    </ul>
                                </div>
                            </div>

                            <div class="template-card" onclick="selectTemplate('custom')">
                                <div class="template-icon">
                                    <i class="fas fa-cogs"></i>
                                </div>
                                <div class="template-title">Custom Report</div>
                                <div class="template-description">Build your own report with custom fields and parameters.</div>
                                <div class="template-features">
                                    <ul>
                                        <li>Custom field selection</li>
                                        <li>Flexible layouts</li>
                                        <li>Advanced filtering</li>
                                        <li>Personalized metrics</li>
                                    </ul>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Parameters -->
                <div class="form-step" id="formStep2">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-sliders-h"></i>
                            Report Parameters
                        </div>
                        <div class="form-grid">
                            <div class="form-group">
                                <label class="form-label">Report Title</label>
                                <input type="text" class="form-control" id="reportTitle" placeholder="Enter custom report title">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Report Description</label>
                                <textarea class="form-control" id="reportDescription" rows="3" placeholder="Brief description of the report"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Output Format</label>
                                <select class="form-select" id="outputFormat">
                                    <option value="pdf">PDF Document</option>
                                    <option value="excel">Excel Spreadsheet</option>
                                    <option value="csv">CSV Data File</option>
                                    <option value="html">HTML Web Page</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Page Orientation</label>
                                <select class="form-select" id="pageOrientation">
                                    <option value="portrait">Portrait</option>
                                    <option value="landscape">Landscape</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-chart-bar"></i>
                                Include Charts & Visualizations
                            </div>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="includeTrends" checked>
                                    <label for="includeTrends">Monthly Trends Chart</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="includeStatus" checked>
                                    <label for="includeStatus">Status Distribution</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="includeSchemes">
                                    <label for="includeSchemes">Scheme Comparison</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="includeDistricts">
                                    <label for="includeDistricts">District Performance</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Filters -->
                <div class="form-step" id="formStep3">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-filter"></i>
                            Data Filters
                        </div>
                        <div class="form-grid">
                                       <div class="form-group">
                                <label class="form-label">Date Range</label>
                                <select class="form-select" id="filterDateRange">
                                    <option value="all">All Time</option>
                                    <option value="today">Today</option>
                                    <option value="yesterday">Yesterday</option>
                                    <option value="last7days">Last 7 Days</option>
                                    <option value="last30days" selected>Last 30 Days</option>
                                    <option value="last3months">Last 3 Months</option>
                                    <option value="last6months">Last 6 Months</option>
                                    <option value="lastyear">Last Year</option>
                                    <option value="custom">Custom Range</option>
                                </select>
                            </div>
                            <div class="form-group" id="customDateGroup" style="display: none;">
                                <label class="form-label">From Date</label>
                                <input type="date" class="form-control" id="customFromDate">
                            </div>
                            <div class="form-group" id="customDateGroup2" style="display: none;">
                                <label class="form-label">To Date</label>
                                <input type="date" class="form-control" id="customToDate">
                            </div>
                            <div class="form-group">
                                <label class="form-label">District</label>
                                <select class="form-select" id="filterDistrict">
                                    <option value="">All Districts</option>
                                    <option value="raipur">Raipur</option>
                                    <option value="bilaspur">Bilaspur</option>
                                    <option value="durg">Durg</option>
                                    <option value="korba">Korba</option>
                                    <option value="jagdalpur">Jagdalpur</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Scheme Type</label>
                                <select class="form-select" id="filterSchemeType">
                                    <option value="">All Schemes</option>
                                    <option value="central">Centrally Sponsored</option>
                                    <option value="state">State Schemes</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Status</label>
                                <select class="form-select" id="filterStatus">
                                    <option value="">All Status</option>
                                    <option value="approved">Approved</option>
                                    <option value="pending">Pending</option>
                                    <option value="rejected">Rejected</option>
                                    <option value="draft">Draft</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-section">
                            <div class="section-title">
                                <i class="fas fa-table"></i>
                                Data Fields to Include
                            </div>
                            <div class="checkbox-group">
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldEntryId" checked>
                                    <label for="fieldEntryId">Entry ID</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldScheme" checked>
                                    <label for="fieldScheme">Scheme Details</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldAmount" checked>
                                    <label for="fieldAmount">Amount Disbursed</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldBeneficiaries" checked>
                                    <label for="fieldBeneficiaries">Beneficiaries</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldDistrict" checked>
                                    <label for="fieldDistrict">District</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldStatus" checked>
                                    <label for="fieldStatus">Status</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldDates">
                                    <label for="fieldDates">Created/Updated Dates</label>
                                </div>
                                <div class="checkbox-item">
                                    <input type="checkbox" id="fieldFinancial">
                                    <label for="fieldFinancial">Financial Breakdown</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 4: Preview -->
                <div class="form-step" id="formStep4">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-eye"></i>
                            Report Preview
                        </div>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            Preview shows a sample of your report based on selected parameters. The actual report will contain complete data.
                        </div>
                        <div id="reportPreview">
                            <!-- Preview content will be loaded here -->
                        </div>
                    </div>
                </div>

                <!-- Step 5: Generate -->
                <div class="form-step" id="formStep5">
                    <div class="form-section">
                        <div class="section-title">
                            <i class="fas fa-rocket"></i>
                            Generate Report
                        </div>
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            Your report is ready to be generated! Review the summary below and click Generate Report.
                        </div>
                        
                        <div class="row">
                            <div class="col-md-6">
                                <h6>Report Configuration</h6>
                                <table class="table table-sm">
                                    <tr><td><strong>Template:</strong></td><td id="summaryTemplate">-</td></tr>
                                    <tr><td><strong>Format:</strong></td><td id="summaryFormat">-</td></tr>
                                    <tr><td><strong>Date Range:</strong></td><td id="summaryDateRange">-</td></tr>
                                    <tr><td><strong>Filters:</strong></td><td id="summaryFilters">-</td></tr>
                                </table>
                            </div>
                            <div class="col-md-6">
                                <h6>Estimated Data</h6>
                                <table class="table table-sm">
                                    <tr><td><strong>Total Records:</strong></td><td id="estimatedRecords">-</td></tr>
                                    <tr><td><strong>File Size:</strong></td><td id="estimatedSize">-</td></tr>
                                    <tr><td><strong>Generation Time:</strong></td><td id="estimatedTime">-</td></tr>
                                    <tr><td><strong>Charts Included:</strong></td><td id="chartsIncluded">-</td></tr>
                                </table>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button class="btn-success" onclick="generateFinalReport()">
                                <i class="fas fa-download"></i>
                                Generate & Download Report
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Navigation Buttons -->
                <div class="step-navigation">
                    <button class="btn-secondary" id="prevBtn" onclick="previousStep()" style="display: none;">
                        <i class="fas fa-arrow-left"></i>
                        Previous
                    </button>
                    <div class="text-muted" id="stepInfo">Step 1 of 5</div>
                    <button class="btn-primary" id="nextBtn" onclick="nextStep()">
                        Next
                        <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
            </div>
        </div>

        <!-- Preview Section -->
        <div class="preview-section" id="previewSection" style="display: none;">
            <div class="preview-header">
                <h5>
                    <i class="fas fa-eye me-2"></i>
                    Live Preview
                </h5>
                <button class="btn btn-outline-primary btn-sm" onclick="refreshPreview()">
                    <i class="fas fa-sync-alt me-1"></i>Refresh
                </button>
            </div>
            <div class="preview-content" id="previewContent">
                <!-- Preview content will be loaded here -->
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.38.4/dist/umd/supabase.min.js"></script>
    <script>
        // Supabase configuration
        const supabaseUrl = 'https://txjbfqrbbtvzlxpeegkv.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InR4amJmcXJiYnR2emx4cGVlZ2t2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTMxMTU2NTQsImV4cCI6MjA2ODY5MTY1NH0.sE5UbwEOSnd9ED-k_Ix5OfdZbf7dmwlHZSjQQrEAyCo';
        
        const { createClient } = supabase;
        const supabaseClient = createClient(supabaseUrl, supabaseKey);

        // Global variables
        let currentUser = null;
        let currentStep = 1;
        let selectedTemplate = null;
        let reportConfig = {};
        let sampleData = [];

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            checkUserAuthentication();
            initializeReportBuilder();
            setupEventListeners();
            loadSampleData();
        });

        // Check authentication
        function checkUserAuthentication() {
            const storedUser = localStorage.getItem('user') || sessionStorage.getItem('user');
            
            if (!storedUser) {
                window.location.href = 'login.html';
                return;
            }
            
            try {
                currentUser = JSON.parse(storedUser);
                
                // Check if user is admin
                if (currentUser.role !== 'admin' && currentUser.role !== 'super_admin') {
                    alert('आपके पास इस पेज का एक्सेस नहीं है।');
                    window.location.href = 'index.html';
                    return;
                }
                
                document.getElementById('userInfo').textContent = 
                    `${currentUser.fullName} - ${currentUser.districtName}`;
                
            } catch (error) {
                console.error('Error parsing user data:', error);
                window.location.href = 'login.html';
            }
        }

        // Initialize report builder
        function initializeReportBuilder() {
            updateStepIndicator();
            updateNavigationButtons();
        }

        // Setup event listeners
        function setupEventListeners() {
            // Date range change handler
            document.getElementById('filterDateRange').addEventListener('change', handleDateRangeChange);
            
            // Checkbox change handlers
            document.querySelectorAll('.checkbox-item input[type="checkbox"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    this.parentElement.classList.toggle('checked', this.checked);
                });
            });

            // Form field change handlers
            document.getElementById('reportTitle').addEventListener('input', updatePreview);
            document.getElementById('outputFormat').addEventListener('change', updatePreview);
        }

        // Handle date range change
        function handleDateRangeChange() {
            const dateRange = document.getElementById('filterDateRange').value;
            const customGroup1 = document.getElementById('customDateGroup');
            const customGroup2 = document.getElementById('customDateGroup2');
            
            if (dateRange === 'custom') {
                customGroup1.style.display = 'block';
                customGroup2.style.display = 'block';
            } else {
                customGroup1.style.display = 'none';
                customGroup2.style.display = 'none';
            }
        }

        // Load sample data
        async function loadSampleData() {
            try {
                // Try to load real data from Supabase
                const { data, error } = await supabaseClient
                    .from('dbt_data_entries')
                    .select('*')
                    .limit(50);

                if (error) {
                    console.warn('Using sample data:', error);
                    sampleData = generateSampleData();
                } else {
                    sampleData = data || generateSampleData();
                }
            } catch (error) {
                console.error('Error loading data:', error);
                sampleData = generateSampleData();
            }
        }

        // Generate sample data
        function generateSampleData() {
            const data = [];
            const schemes = ['SS1', 'CS1', 'SS7', 'CS8', 'SS12'];
            const districts = ['Raipur', 'Bilaspur', 'Durg', 'Korba', 'Jagdalpur'];
            const statuses = ['approved', 'pending', 'rejected', 'draft'];
            
            for (let i = 0; i < 50; i++) {
                const date = new Date();
                date.setDate(date.getDate() - Math.floor(Math.random() * 90));
                
                data.push({
                    id: `DBT${String(i + 1).padStart(3, '0')}`,
                    scheme_code: schemes[Math.floor(Math.random() * schemes.length)],
                    district: districts[Math.floor(Math.random() * districts.length)],
                    status: statuses[Math.floor(Math.random() * statuses.length)],
                    totalAmountDisbursed: Math.floor(Math.random() * 500000) + 50000,
                    totalBeneficiaries: Math.floor(Math.random() * 200) + 20,
                    created_at: date.toISOString()
                });
            }
            
            return data;
        }

        // Template selection
        function selectTemplate(templateType) {
            // Remove previous selection
            document.querySelectorAll('.template-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            // Add selection to clicked card
            event.target.closest('.template-card').classList.add('selected');
            
            selectedTemplate = templateType;
            reportConfig.template = templateType;
            
            // Auto-populate report title based on template
            const titles = {
                'summary': 'DBT Summary Report',
                'scheme': 'Scheme-wise Analysis Report',
                'district': 'District Performance Report',
                'financial': 'Financial Analysis Report',
                'beneficiary': 'Beneficiary Analysis Report',
                'custom': 'Custom DBT Report'
            };
            
            document.getElementById('reportTitle').value = titles[templateType] || 'Custom Report';
            
            showAlert(`${titles[templateType]} template selected!`, 'success');
        }

        // Navigation functions
        function nextStep() {
            if (validateCurrentStep()) {
                if (currentStep < 5) {
                    currentStep++;
                    showStep(currentStep);
                    updateStepIndicator();
                    updateNavigationButtons();
                    
                    if (currentStep === 4) {
                        generatePreview();
                    } else if (currentStep === 5) {
                        generateSummary();
                    }
                }
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                showStep(currentStep);
                updateStepIndicator();
                updateNavigationButtons();
            }
        }

        // Validate current step
        function validateCurrentStep() {
            switch(currentStep) {
                case 1:
                    if (!selectedTemplate) {
                        showAlert('Please select a report template to continue.', 'warning');
                        return false;
                    }
                    break;
                case 2:
                    const title = document.getElementById('reportTitle').value.trim();
                    if (!title) {
                        showAlert('Please enter a report title.', 'warning');
                        document.getElementById('reportTitle').focus();
                        return false;
                    }
                    break;
                case 3:
                    // Filters are optional, so always valid
                    break;
                case 4:
                    // Preview step, always valid
                    break;
            }
            return true;
        }

        // Show specific step
        function showStep(stepNumber) {
            // Hide all steps
            document.querySelectorAll('.form-step').forEach(step => {
                step.classList.remove('active');
            });
            
            // Show current step
            document.getElementById(`formStep${stepNumber}`).classList.add('active');
        }

        // Update step indicator
        function updateStepIndicator() {
            for (let i = 1; i <= 5; i++) {
                const step = document.getElementById(`step${i}`);
                
                if (i < currentStep) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (i === currentStep) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            }
        }

        // Update navigation buttons
        function updateNavigationButtons() {
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const stepInfo = document.getElementById('stepInfo');
            
            // Previous button
            if (currentStep === 1) {
                prevBtn.style.display = 'none';
            } else {
                prevBtn.style.display = 'inline-flex';
            }
            
            // Next button
            if (currentStep === 5) {
                nextBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'inline-flex';
                nextBtn.innerHTML = currentStep === 4 ? 
                    'Generate Preview <i class="fas fa-eye"></i>' : 
                    'Next <i class="fas fa-arrow-right"></i>';
            }
            
            // Step info
            stepInfo.textContent = `Step \${currentStep} of 5`;
        }

        // Generate preview
        function generatePreview() {
            const previewDiv = document.getElementById('reportPreview');
            
            // Collect current configuration
            collectReportConfig();
            
            // Generate preview based on template
            let previewHTML = generatePreviewHTML();
            
            previewDiv.innerHTML = previewHTML;
            
            // Show preview section
            document.getElementById('previewSection').style.display = 'block';
        }

        // Collect report configuration
        function collectReportConfig() {
            reportConfig = {
                template: selectedTemplate,
                title: document.getElementById('reportTitle').value,
                description: document.getElementById('reportDescription').value,
                format: document.getElementById('outputFormat').value,
                orientation: document.getElementById('pageOrientation').value,
                dateRange: document.getElementById('filterDateRange').value,
                district: document.getElementById('filterDistrict').value,
                schemeType: document.getElementById('filterSchemeType').value,
                status: document.getElementById('filterStatus').value,
                customFromDate: document.getElementById('customFromDate').value,
                customToDate: document.getElementById('customToDate').value,
                includeCharts: {
                    trends: document.getElementById('includeTrends').checked,
                    status: document.getElementById('includeStatus').checked,
                    schemes: document.getElementById('includeSchemes').checked,
                    districts: document.getElementById('includeDistricts').checked
                },
                fields: {
                    entryId: document.getElementById('fieldEntryId').checked,
                    scheme: document.getElementById('fieldScheme').checked,
                    amount: document.getElementById('fieldAmount').checked,
                    beneficiaries: document.getElementById('fieldBeneficiaries').checked,
                    district: document.getElementById('fieldDistrict').checked,
                    status: document.getElementById('fieldStatus').checked,
                    dates: document.getElementById('fieldDates').checked,
                    financial: document.getElementById('fieldFinancial').checked
                }
            };
        }

        // Generate preview HTML
        function generatePreviewHTML() {
            const filteredData = filterSampleData();
            
            let html = `
                <div class="preview-report">
                    <div class="report-header text-center mb-4">
                        <h3>\${reportConfig.title}</h3>
                        <p class="text-muted">\${reportConfig.description || 'Generated on ' + new Date().toLocaleDateString('en-IN')}</p>
                    </div>
                    
                    <div class="report-summary mb-4">
                        <div class="row">
                            <div class="col-md-3 text-center">
                                <h4 class="text-primary">\${filteredData.length}</h4>
                                <small class="text-muted">Total Records</small>
                            </div>
                            <div class="col-md-3 text-center">
                                <h4 class="text-success">₹\${formatCurrency(filteredData.reduce((sum, item) => sum + (parseFloat(item.totalAmountDisbursed) || 0), 0))}</h4>
                                <small class="text-muted">Total Amount</small>
                            </div>
                            <div class="col-md-3 text-center">
                                <h4 class="text-info">\${filteredData.reduce((sum, item) => sum + (parseInt(item.totalBeneficiaries) || 0), 0)}</h4>
                                <small class="text-muted">Beneficiaries</small>
                            </div>
                            <div class="col-md-3 text-center">
                                <h4 class="text-warning">\${Math.round((filteredData.filter(item => item.status === 'approved').length / filteredData.length) * 100)}%</h4>
                                <small class="text-muted">Approval Rate</small>
                            </div>
                        </div>
                    </div>
            `;

            // Add chart placeholders if enabled
            if (reportConfig.includeCharts.trends || reportConfig.includeCharts.status) {
                html += `
                    <div class="row mb-4">
                        \${reportConfig.includeCharts.trends ? `
                            <div class="col-md-6">
                                <div class="preview-chart">
                                    <i class="fas fa-chart-line fa-3x text-muted mb-3"></i>
                                    <div>Monthly Trends Chart</div>
                                    <small class="text-muted">Will be generated in final report</small>
                                </div>
                            </div>
                        ` : ''}
                        \${reportConfig.includeCharts.status ? `
                            <div class="col-md-6">
                                <div class="preview-chart">
                                    <i class="fas fa-chart-pie fa-3x text-muted mb-3"></i>
                                    <div>Status Distribution Chart</div>
                                    <small class="text-muted">Will be generated in final report</small>
                                </div>
                            </div>
                        ` : ''}
                    </div>
                `;
            }

            // Add data table
            html += `
                <div class="table-responsive">
                    <table class="preview-table">
                        <thead>
                            <tr>
                                \${reportConfig.fields.entryId ? '<th>Entry ID</th>' : ''}
                                \${reportConfig.fields.scheme ? '<th>Scheme</th>' : ''}
                                \${reportConfig.fields.district ? '<th>District</th>' : ''}
                                \${reportConfig.fields.amount ? '<th>Amount</th>' : ''}
                                \${reportConfig.fields.beneficiaries ? '<th>Beneficiaries</th>' : ''}
                                \${reportConfig.fields.status ? '<th>Status</th>' : ''}
                                \${reportConfig.fields.dates ? '<th>Date</th>' : ''}
                            </tr>
                        </thead>
                        <tbody>
            `;

            // Add sample rows (first 10)
            filteredData.slice(0, 10).forEach(item => {
                html += `
                    <tr>
                        \${reportConfig.fields.entryId ? `<td>${item.id}</td>` : ''}
                        \${reportConfig.fields.scheme ? `<td>${item.scheme_code}</td>` : ''}
                        \${reportConfig.fields.district ? `<td>${item.district}</td>` : ''}
                        \${reportConfig.fields.amount ? `<td>₹${formatCurrency(item.totalAmountDisbursed)}</td>` : ''}
                        \${reportConfig.fields.beneficiaries ? `<td>${item.totalBeneficiaries}</td>` : ''}
                        \${reportConfig.fields.status ? `<td><span class="badge bg-${getStatusColor(item.status)}">${item.status}</span></td>` : ''}
                        \${reportConfig.fields.dates ? `<td>${new Date(item.created_at).toLocaleDateString('en-IN')}</td>` : ''}
                    </tr>
                `;
            });

            html += `
                        </tbody>
                    </table>
                </div>
                <div class="text-center mt-3">
                    <small class="text-muted">Showing first 10 records. Full report will contain all \${filteredData.length} records.</small>
                </div>
            </div>
            `;

            return html;
        }

        // Filter sample data based on configuration
        function filterSampleData() {
            let filtered = [...sampleData];

            // Date range filter
            if (reportConfig.dateRange && reportConfig.dateRange !== 'all') {
                const now = new Date();
                let startDate = new Date();

                switch(reportConfig.dateRange) {
                    case 'today':
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'yesterday':
                        startDate.setDate(now.getDate() - 1);
                        startDate.setHours(0, 0, 0, 0);
                        break;
                    case 'last7days':
                        startDate.setDate(now.getDate() - 7);
                        break;
                    case 'last30days':
                        startDate.setDate(now.getDate() - 30);
                        break;
                    case 'last3months':
                        startDate.setMonth(now.getMonth() - 3);
                        break;
                    case 'last6months':
                        startDate.setMonth(now.getMonth() - 6);
                        break;
                    case 'lastyear':
                        startDate.setFullYear(now.getFullYear() - 1);
                        break;
                    case 'custom':
                        if (reportConfig.customFromDate) {
                            startDate = new Date(reportConfig.customFromDate);
                        }
                        break;
                }

                filtered = filtered.filter(item => {
                    const itemDate = new Date(item.created_at);
                    return itemDate >= startDate;
                });

                if (reportConfig.dateRange === 'custom' && reportConfig.customToDate) {
                    const endDate = new Date(reportConfig.customToDate);
                    filtered = filtered.filter(item => {
                        const itemDate = new Date(item.created_at);
                        return itemDate <= endDate;
                    });
                }
            }

            // District filter
            if (reportConfig.district) {
                filtered = filtered.filter(item => item.district.toLowerCase() === reportConfig.district);
            }

            // Status filter
            if (reportConfig.status) {
                filtered = filtered.filter(item => item.status === reportConfig.status);
            }

            return filtered;
        }

        // Generate summary for step 5
        function generateSummary() {
            collectReportConfig();
            const filteredData = filterSampleData();

            // Update summary fields
            document.getElementById('summaryTemplate').textContent = selectedTemplate.charAt(0).toUpperCase() + selectedTemplate.slice(1) + ' Report';
            document.getElementById('summaryFormat').textContent = reportConfig.format.toUpperCase();
            document.getElementById('summaryDateRange').textContent = getDateRangeText();
            document.getElementById('summaryFilters').textContent = getFiltersText();
            document.getElementById('estimatedRecords').textContent = filteredData.length.toLocaleString();
            document.getElementById('estimatedSize').textContent = estimateFileSize(filteredData.length, reportConfig.format);
            document.getElementById('estimatedTime').textContent = estimateGenerationTime(filteredData.length);
            document.getElementById('chartsIncluded').textContent = getChartsIncludedText();
        }

        // Helper functions for summary
        function getDateRangeText() {
            const range = reportConfig.dateRange;
            if (range === 'custom') {
                return `${reportConfig.customFromDate} to ${reportConfig.customToDate}`;
            }
            return range.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
        }

        function getFiltersText() {
            const filters = [];
            if (reportConfig.district) filters.push(`District: ${reportConfig.district}`);
            if (reportConfig.schemeType) filters.push(`Scheme: ${reportConfig.schemeType}`);
            if (reportConfig.status) filters.push(`Status: ${reportConfig.status}`);
            return filters.length > 0 ? filters.join(', ') : 'None';
        }

        function estimateFileSize(records, format) {
            const baseSize = records * 0.5; // KB per record
            const multiplier = { pdf: 2, excel: 1.5, csv: 0.5, html: 1.2 };
            const size = baseSize * (multiplier[format] || 1);
            
            if (size < 1024) return `${Math.round(size)} KB`;
            return `${Math.round(size / 1024 * 100) / 100} MB`;
        }

        function estimateGenerationTime(records) {
            const baseTime = Math.max(5, records * 0.01); // seconds
            if (baseTime < 60) return `${Math.round(baseTime)} seconds`;
            return `${Math.round(baseTime / 60)} minutes`;
        }

        function getChartsIncludedText() {
            const charts = [];
            if (reportConfig.includeCharts.trends) charts.push('Trends');
            if (reportConfig.includeCharts.status) charts.push('Status');
            if (reportConfig.includeCharts.schemes) charts.push('Schemes');
            if (reportConfig.includeCharts.districts) charts.push('Districts');
            return charts.length > 0 ? charts.join(', ') : 'None';
        }

        // Generate final report
        function generateFinalReport() {
            showLoading(true);
            updateProgress(0, 'Initializing report generation...');
            
            setTimeout(() => {
                updateProgress(20, 'Collecting data...');
                
                setTimeout(() => {
                    updateProgress(40, 'Processing filters...');
                    
                    setTimeout(() => {
                        updateProgress(60, 'Generating charts...');
                        
                        setTimeout(() => {
                            updateProgress(80, 'Formatting report...');
                            
                            setTimeout(() => {
                                updateProgress(100, 'Finalizing...');
                                
                                setTimeout(() => {
                                    // Generate the actual report based on format
                                    const format = reportConfig.format;
                                    switch(format) {
                                        case 'pdf':
                                            generatePDFReport();
                                            break;
                                        case 'excel':
                                            generateExcelReport();
                                            break;
                                        case 'csv':
                                            generateCSVReport();
                                            break;
                                        case 'html':
                                            generateHTMLReport();
                                            break;
                                    }
                                    
                                    showLoading(false);
                                    showAlert('Report generated successfully!', 'success');
                                }, 500);
                            }, 1000);
                        }, 1000);
                    }, 1000);
                }, 1000);
            }, 1000);
        }

        // Update progress
        function updateProgress(percentage, text) {
            document.getElementById('progressSection').style.display = 'block';
            document.getElementById('progressFill').style.width = percentage + '%';
            document.getElementById('progressFill').textContent = percentage + '%';
            document.getElementById('progressText').textContent = text;
        }

        // Generate PDF report
        function generatePDFReport() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF(reportConfig.orientation === 'landscape' ? 'l' : 'p');
            
            const filteredData = filterSampleData();
            
            // Add title
            doc.setFontSize(20);
            doc.text(reportConfig.title, 20, 20);
            
            // Add description
            if (reportConfig.description) {
                doc.setFontSize(12);
                doc.text(reportConfig.description, 20, 35);
            }
            
            // Add generation date
            doc.setFontSize(10);
            doc.text(`Generated on: ${new Date().toLocaleDateString('en-IN')}`, 20, 45);
            doc.text(`Total Records: ${filteredData.length}`, 20, 55);
            
            // Add summary statistics
            const totalAmount = filteredData.reduce((sum, item) => sum + (parseFloat(item.totalAmountDisbursed) || 0), 0);
            const totalBeneficiaries = filteredData.reduce((sum, item) => sum + (parseInt(item.totalBeneficiaries) || 0), 0);
            const approvalRate = Math.round((filteredData.filter(item => item.status === 'approved').length / filteredData.length) * 100);
            
            doc.setFontSize(12);
            doc.text(`Total Amount Disbursed: ₹${formatCurrency(totalAmount)}`, 20, 70);
            doc.text(`Total Beneficiaries: ${totalBeneficiaries.toLocaleString()}`, 20, 80);
            doc.text(`Approval Rate: ${approvalRate}%`, 20, 90);
            
            // Add data table (first page)
            if (filteredData.length > 0) {
                doc.setFontSize(10);
                let yPos = 110;
                
                // Table headers
                const headers = [];
                const colWidths = [];
                let xPos = 20;
                
                if (reportConfig.fields.entryId) { headers.push('Entry ID'); colWidths.push(30); }
                if (reportConfig.fields.scheme) { headers.push('Scheme'); colWidths.push(25); }
                if (reportConfig.fields.district) { headers.push('District'); colWidths.push(25); }
                if (reportConfig.fields.amount) { headers.push('Amount'); colWidths.push(35); }
                if (reportConfig.fields.beneficiaries) { headers.push('Beneficiaries'); colWidths.push(30); }
                if (reportConfig.fields.status) { headers.push('Status'); colWidths.push(25); }
                
                // Draw headers
                headers.forEach((header, index) => {
                    doc.text(header, xPos, yPos);
                    xPos += colWidths[index];
                });
                
                yPos += 10;
                
                // Draw data rows (first 20 rows)
                filteredData.slice(0, 20).forEach(item => {
                    xPos = 20;
                    
                    if (reportConfig.fields.entryId) {
                        doc.text(item.id, xPos, yPos);
                        xPos += colWidths[0];
                    }
                    if (reportConfig.fields.scheme) {
                        doc.text(item.scheme_code, xPos, yPos);
                        xPos += colWidths[1];
                    }
                    if (reportConfig.fields.district) {
                        doc.text(item.district, xPos, yPos);
                        xPos += colWidths[2];
                    }
                    if (reportConfig.fields.amount) {
                        doc.text(`₹${formatCurrency(item.totalAmountDisbursed)}`, xPos, yPos);
                        xPos += colWidths[3];
                    }
                    if (reportConfig.fields.beneficiaries) {
                        doc.text(item.totalBeneficiaries.toString(), xPos, yPos);
                        xPos += colWidths[4];
                    }
                    if (reportConfig.fields.status) {
                        doc.text(item.status, xPos, yPos);
                        xPos += colWidths[5];
                    }
                    
                    yPos += 8;
                    
                    if (yPos > 270) break; // Page limit
                });
                
                if (filteredData.length > 20) {
                    doc.text(`... and ${filteredData.length - 20} more records`, 20, yPos + 10);
                }
            }
            
            // Save PDF
            doc.save(`${reportConfig.title.replace(/\s+/g, '-').toLowerCase()}.pdf`);
        }

        // Generate Excel report
        function generateExcelReport() {
            const filteredData = filterSampleData();
            const wb = XLSX.utils.book_new();
            
            // Summary sheet
            const summaryData = [
                [reportConfig.title],
                [reportConfig.description || ''],
                [],
                ['Generated on:', new Date().toLocaleDateString('en-IN')],
                ['Total Records:', filteredData.length],
                ['Total Amount:', `₹${formatCurrency(filteredData.reduce((sum, item) => sum + (parseFloat(item.totalAmountDisbursed) || 0), 0))}`],
                ['Total Beneficiaries:', filteredData.reduce((sum, item) => sum + (parseInt(item.totalBeneficiaries) || 0), 0)],
                [],
                ['Filters Applied:'],
                ['Date Range:', getDateRangeText()],
                ['District:', reportConfig.district || 'All'],
                ['Status:', reportConfig.status || 'All']
            ];
            
            const summaryWs = XLSX.utils.aoa_to_sheet(summaryData);
            XLSX.utils.book_append_sheet(wb, summaryWs, 'Summary');
            
            // Data sheet
            const headers = [];
            if (reportConfig.fields.entryId) headers.push('Entry ID');
            if (reportConfig.fields.scheme) headers.push('Scheme Code');
            if (reportConfig.fields.district) headers.push('District');
            if (reportConfig.fields.amount) headers.push('Amount Disbursed');
            if (reportConfig.fields.beneficiaries) headers.push('Beneficiaries');
            if (reportConfig.fields.status) headers.push('Status');
            if (reportConfig.fields.dates) headers.push('Created Date');
            
            const dataRows = filteredData.map(item => {
                const row = [];
                if (reportConfig.fields.entryId) row.push(item.id);
                if (reportConfig.fields.scheme) row.push(item.scheme_code);
                if (reportConfig.fields.district) row.push(item.district);
                if (reportConfig.fields.amount) row.push(item.totalAmountDisbursed);
                if (reportConfig.fields.beneficiaries) row.push(item.totalBeneficiaries);
                if (reportConfig.fields.status) row.push(item.status);
                if (reportConfig.fields.dates) row.push(new Date(item.created_at).toLocaleDateString('en-IN'));
                return row;
            });
            
            const dataWs = XLSX.utils.aoa_to_sheet([headers, ...dataRows]);
            XLSX.utils.book_append_sheet(wb, dataWs, 'Data');
            
            // Save Excel file
            XLSX.writeFile(wb, `${reportConfig.title.replace(/\s+/g, '-').toLowerCase()}.xlsx`);
        }

        // Generate CSV report
        function generateCSVReport() {
            const filteredData = filterSampleData();
            
            const headers = [];
            if (reportConfig.fields.entryId) headers.push('Entry ID');
            if (reportConfig.fields.scheme) headers.push('Scheme Code');
            if (reportConfig.fields.district) headers.push('District');
            if (reportConfig.fields.amount) headers.push('Amount Disbursed');
            if (reportConfig.fields.beneficiaries) headers.push('Beneficiaries');
            if (reportConfig.fields.status) headers.push('Status');
            if (reportConfig.fields.dates) headers.push('Created Date');
            
            const rows = filteredData.map(item => {
                const row = [];
                if (reportConfig.fields.entryId) row.push(item.id);
                if (reportConfig.fields.scheme) row.push(item.scheme_code);
                if (reportConfig.fields.district) row.push(item.district);
                if (reportConfig.fields.amount) row.push(item.totalAmountDisbursed);
                if (reportConfig.fields.beneficiaries) row.push(item.totalBeneficiaries);
                if (reportConfig.fields.status) row.push(item.status);
                if (reportConfig.fields.dates) row.push(new Date(item.created_at).toLocaleDateString('en-IN'));
                return row;
            });
            
            const csvContent = [headers, ...rows]
                .map(row => row.map(field => `"${field}"`).join(','))
                .join('\n');
            
            downloadCSV(csvContent, `${reportConfig.title.replace(/\s+/g, '-').toLowerCase()}.csv`);
        }

        // Generate HTML report
        function generateHTMLReport() {
            const filteredData = filterSampleData();
            
            const htmlContent = `
                <!DOCTYPE html>
                <html>
                <head>
                    <title>${reportConfig.title}</title>
                    <style>
                        body { font-family: Arial, sans-serif; margin: 20px; }
                        .header { text-align: center; margin-bottom: 30px; }
                        .summary { background: #f8f9fa; padding: 20px; margin-bottom: 30px; border-radius: 8px; }
                        .stats { display: flex; justify-content: space-around; margin: 20px 0; }
                        .stat { text-align: center; }
                        .stat h3 { margin: 0; color: #0d47a1; }
                        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
                        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
                        th { background-color: #e3f2fd; color: #0d47a1; font-weight: bold; }
                        tr:nth-child(even) { background-color: #f9f9f9; }
                        .badge { padding: 4px 8px; border-radius: 4px; font-size: 0.8em; }
                        .badge-approved { background: #d4edda; color: #155724; }
                        .badge-pending { background: #fff3cd; color: #856404; }
                        .badge-rejected { background: #f8d7da; color: #721c24; }
                        .badge-draft { background: #e2e3e5; color: #383d41; }
                    </style>
                </head>
                <body>
                    <div class="header">
                        <h1>${reportConfig.title}</h1>
                        <p>${reportConfig.description || ''}</p>
                        <p><small>Generated on ${new Date().toLocaleDateString('en-IN')}</small></p>
                    </div>
                    
                    <div class="summary">
                        <h3>Report Summary</h3>
                        <div class="stats">
                            <div class="stat">
                                <h3>${filteredData.length}</h3>
                                <p>Total Records</p>
                            </div>
                            <div class="stat">
                                <h3>₹${formatCurrency(filteredData.reduce((sum, item) => sum + (parseFloat(item.totalAmountDisbursed) || 0), 0))}</h3>
                                <p>Total Amount</p>
                            </div>
                            <div class="stat">
                                <h3>${filteredData.reduce((sum, item) => sum + (parseInt(item.totalBeneficiaries) || 0), 0)}</h3>
                                <p>Beneficiaries</p>
                            </div>
                            <div class="stat">
                                <h3>${Math.round((filteredData.filter(item => item.status === 'approved').length / filteredData.length) * 100)}%</h3>
                                <p>Approval Rate</p>
                            </div>
                        </div>
                    </div>
                    
                    <table>
                        <thead>
                            <tr>
                                ${reportConfig.fields.entryId ? '<th>Entry ID</th>' : ''}
                                ${reportConfig.fields.scheme ? '<th>Scheme Code</th>' : ''}
                                ${reportConfig.fields.district ? '<th>District</th>' : ''}
                                ${reportConfig.fields.amount ? '<th>Amount</th>' : ''}
                                ${reportConfig.fields.beneficiaries ? '<th>Beneficiaries</th>' : ''}
                                ${reportConfig.fields.status ? '<th>Status</th>' : ''}
                                ${reportConfig.fields.dates ? '<th>Date</th>' : ''}
                            </tr>
                        </thead>
                        <tbody>
                            ${filteredData.map(item => `
                                <tr>
                                    ${reportConfig.fields.entryId ? `<td>${item.id}</td>` : ''}
                                    ${reportConfig.fields.scheme ? `<td>${item.scheme_code}</td>` : ''}
                                    ${reportConfig.fields.district ? `<td>${item.district}</td>` : ''}
                                    ${reportConfig.fields.amount ? `<td>₹${formatCurrency(item.totalAmountDisbursed)}</td>` : ''}
                                    ${reportConfig.fields.beneficiaries ? `<td>${item.totalBeneficiaries}</td>` : ''}
                                    ${reportConfig.fields.status ? `<td><span class="badge badge-${item.status}">${item.status}</span></td>` : ''}
                                    ${reportConfig.fields.dates ? `<td>${new Date(item.created_at).toLocaleDateString('en-IN')}</td>` : ''}
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </body>
                </html>
            `;
            
            downloadHTML(htmlContent, `${reportConfig.title.replace(/\s+/g, '-').toLowerCase()}.html`);
        }

        // Utility functions
        function updatePreview() {
            // This function would update the live preview as user changes parameters
            // For now, it's a placeholder
        }

        function refreshPreview() {
            if (currentStep >= 4) {
                generatePreview();
                showAlert('Preview refreshed!', 'info');
            }
        }

        function showLoading(show) {
            const overlay = document.getElementById('loadingOverlay');
            overlay.style.display = show ? 'flex' : 'none';
            
            if (!show) {
                document.getElementById('progressSection').style.display = 'none';
            }
        }

        function showAlert(message, type) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type} alert-dismissible fade show position-fixed`;
            alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'danger' ? 'exclamation-triangle' : 'info-circle'} me-2"></i>
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            
            document.body.appendChild(alertDiv);
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.remove();
                }
            }, 5000);
        }

        function formatCurrency(amount) {
            return new Intl.NumberFormat('en-IN', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 0
            }).format(amount);
        }

        function getStatusColor(status) {
            const colors = {
                'approved': 'success',
                'pending': 'warning',
                'rejected': 'danger',
                'draft': 'secondary'
            };
            return colors[status] || 'secondary';
        }

        function downloadCSV(content, filename) {
            const blob = new Blob([content], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function downloadHTML(content, filename) {
            const blob = new Blob([content], { type: 'text/html;charset=utf-8;' });
            const link = document.createElement('a');
            const url = URL.createObjectURL(blob);
            link.setAttribute('href', url);
            link.setAttribute('download', filename);
            link.style.visibility = 'hidden';
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
        }

        function logout() {
            if (confirm('Are you sure you want to logout?')) {
                localStorage.removeItem('user');
                sessionStorage.removeItem('user');
                window.location.href = 'login.html';
            }
        }

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            // Ctrl + Enter to proceed to next step
            if (e.ctrlKey && e.key === 'Enter') {
                e.preventDefault();
                if (currentStep < 5) {
                    nextStep();
                } else {
                    generateFinalReport();
                }
            }
            
            // Escape to go back
            if (e.key === 'Escape' && currentStep > 1) {
                e.preventDefault();
                previousStep();
            }
        });

        console.log(`
        ╔══════════════════════════════════════════════════════════════╗
        ║                 Report Generator Loaded                      ║
        ║                DBT Data Entry System                         ║
        ║                                                              ║
        ║  📊 5-Step Report Builder                                    ║
        ║  📄 Multiple Output Formats (PDF, Excel, CSV, HTML)         ║
        ║  🎨 Customizable Templates                                   ║
        ║  🔍 Advanced Filtering Options                              ║
        ║  📈 Chart Integration                                        ║
        ║  👁️ Live Preview                                           ║
        ║                                                              ║
        ║  Report Types:                                               ║
        ║  • Summary Reports                                           ║
        ║  • Scheme Analysis                                           ║
        ║  • District Performance                                      ║
        ║  • Financial Analysis                                        ║
        ║  • Beneficiary Reports                                       ║
        ║  • Custom Reports                                            ║
        ║                                                              ║
        ║  Keyboard Shortcuts:                                         ║
        ║  • Ctrl + Enter: Next Step / Generate                       ║
        ║  • Escape: Previous Step                                     ║
        ║                                                              ║
        ╚══════════════════════════════════════════════════════════════╝
        `);

    </script>
</body>
</html>



